(("undefined"!==typeof self?self:this)["webpackChunkcapi_0_8_3_rc1"]=("undefined"!==typeof self?self:this)["webpackChunkcapi_0_8_3_rc1"]||[]).push([[739],{27288:function(e,t,a){"use strict";a.r(t);var r=a(40429),l=a.n(r),s=a(1214),o=a.n(s),n=o()(l());n.push([e.id,'.align-center[data-v-72db663a]{align-self:"center"}.input-label[data-v-72db663a]{color:var(--input-label);margin-bottom:5px;display:block;width:100%}.input-label .icon-warning[data-v-72db663a]{color:var(--error)}',""]),t["default"]=n},93282:function(e,t,a){"use strict";a.r(t);var r=a(40429),l=a.n(r),s=a(1214),o=a.n(s),n=o()(l());n.push([e.id,".variables[data-v-2e888091]{display:flex;flex-direction:row;flex-wrap:wrap}.variables[data-v-2e888091]>*{flex:0 1 23.25%;margin:0 1.75% 10px 0;max-width:23.25%}.variables[data-v-2e888091]>.wider{flex:0 1 48.25%;max-width:48.25%}.variables>.force-newline[data-v-2e888091]{flex:1 0 100%;max-width:none}",""]),t["default"]=n},32309:function(e,t,a){"use strict";a.r(t);var r=a(40429),l=a.n(r),s=a(1214),o=a.n(s),n=o()(l());n.push([e.id,".container[data-v-01bc296c]{display:grid;grid-template-columns:1fr 1fr 1fr}@media only screen and (max-width:992px){.container[data-v-01bc296c]{grid-template-columns:1fr 1fr}}@media only screen and (max-width:1281px){.container[data-v-01bc296c]{grid-template-columns:1fr}}",""]),t["default"]=n},94579:function(e,t,a){"use strict";a.r(t);var r=a(40429),l=a.n(r),s=a(1214),o=a.n(s),n=o()(l());n.push([e.id,".label[data-v-7407ec5d]{display:flex;flex-direction:column;margin-bottom:10px}.label .text-label[data-v-7407ec5d]{font-size:12px;line-height:18px;color:var(--darker)}.label .value[data-v-7407ec5d]{line-height:18px}",""]),t["default"]=n},39697:function(e,t,a){"use strict";a.r(t);var r=a(40429),l=a.n(r),s=a(1214),o=a.n(s),n=o()(l());n.push([e.id,".cluster-card-container[data-v-2904248b]{display:flex;flex-basis:40%;margin:10px;min-height:100px;padding:10px 20px;height:90%;border:1px solid var(--border);border-radius:var(--border-radius)}.cluster-card-container.selected[data-v-2904248b]{border:2px solid var(--app-rancher-accent)}.cluster-card-container[data-v-2904248b]:hover{box-shadow:0 0 30px var(--shadow);transition:box-shadow .1s ease-in-out;cursor:pointer;text-decoration:none!important}.cluster-card-container.rancher .deploys-os-label[data-v-2904248b],.cluster-card-container.rancher .side-label[data-v-2904248b]{background-color:var(--app-rancher-accent)}.cluster-card-container.rancher .deploys-os-label label[data-v-2904248b],.cluster-card-container.rancher .side-label label[data-v-2904248b]{color:var(--app-rancher-accent-text)}.cluster-card-container.rancher[data-v-2904248b]:hover{border-color:var(--app-rancher-accent)}.cluster-card-container.partner .deploys-os-label[data-v-2904248b],.cluster-card-container.partner .side-label[data-v-2904248b]{background-color:var(--app-partner-accent)}.cluster-card-container.partner .deploys-os-label label[data-v-2904248b],.cluster-card-container.partner .side-label label[data-v-2904248b]{color:var(--app-partner-accent-text)}.cluster-card-container.partner[data-v-2904248b]:hover{border-color:var(--app-partner-accent)}.cluster-card-container .card-wrap[data-v-2904248b]{width:100%}.name[data-v-2904248b]{font-size:16px;font-weight:700;margin-bottom:10px}.description[data-v-2904248b]{font-size:14px;margin-bottom:20px}.container[data-v-2904248b]{display:grid;padding:0;grid-template-columns:1fr 1fr}@media only screen and (max-width:1281px){.container[data-v-2904248b]{grid-template-columns:1fr}}.leftcol[data-v-2904248b]{justify-self:start;margin-right:10px}.rightcol[data-v-2904248b]{justify-self:end}@media only screen and (max-width:1281px){.rightcol[data-v-2904248b]{justify-self:start}}",""]),t["default"]=n},1239:function(e,t,a){"use strict";a.r(t);var r=a(40429),l=a.n(r),s=a(1214),o=a.n(s),n=o()(l());n.push([e.id,".required[data-v-42576d08]{color:var(--error)}",""]),t["default"]=n},35124:function(e,t,a){"use strict";a.r(t);var r=a(40429),l=a.n(r),s=a(1214),o=a.n(s),n=o()(l());n.push([e.id,".grouped-type{position:relative}.rke-switch{margin-top:-10px;position:absolute;right:0}",""]),t["default"]=n},13089:function(e,t,a){"use strict";a.d(t,{Eg:function(){return y},IF:function(){return g},O9:function(){return m},Q3:function(){return k},Vd:function(){return N},l1:function(){return b},qW:function(){return u},tn:function(){return h},wU:function(){return C},z0:function(){return f}});var r=a(3514),l=a.n(r),s=a(92043),o=a(87898),n=a(56158),i=a(24850),c=a(2722),d=a.n(c);const u=function(e,{key:t="Value"},a){const{exclusiveMinimum:r,exclusiveMaximum:l,maxItems:s,maxLength:o,maximum:n,minItems:i,minLength:c,minimum:d,pattern:u,uniqueItems:m,required:h,format:b}=a,k=[];return n&&(l?k.push((a=>Number(a)>=Number(n)?e("validation.exclusiveMaxValue",{key:t,maximum:n}):void 0)):k.push((a=>Number(a)>Number(n)?e("validation.maxValue",{key:t,max:n}):void 0))),void 0!==d&&(r?k.push((a=>Number(a)<=Number(d)?e("validation.exclusiveMinValue",{key:t,minimum:d}):void 0)):k.push((a=>Number(a)<Number(d)?e("validation.minValue",{key:t,min:d}):void 0))),void 0!==c&&k.push((a=>a&&a.length<Number(c)?e("validation.minLength",{key:t,min:c}):void 0)),o&&k.push((a=>a&&a.length>Number(o)?e("validation.maxLength",{key:t,max:o}):void 0)),s&&k.push((a=>a&&a.length>s?e("validation.maxItems",{key:t,maxItems:s}):void 0)),void 0!==i&&k.push((a=>a&&a.length<i?e("validation.minItems",{key:t,minItems:i}):void 0)),u&&k.push(p(e("validation.pattern",{key:t,pattern:u}),new RegExp(u))),b&&v(e,{key:t},b)&&k.push(v(e,{key:t},b)),m&&k.push((a=>a&&a.filter(((e,t)=>a.indexOf(e)!==t)).length?e("validation.uniqueItems",{key:t}):void 0)),h&&k.push((a=>h.find((e=>void 0===a[e]))?e("validation.requiredFields",{key:t,requiredFields:h.toString()}):void 0)),k},p=function(e,t){return a=>a&&!a.match(t)?e:void 0},v=function(e,{key:t="Value"},a){const r=(0,n.A)(e,{key:t}),l=e("validation.stringFormat",{key:t,format:a});switch(a){case"hostname":return e=>r.wildcardHostname(e);case"ipv4":return e=>e&&!(0,s.eH)(e)?l:void 0;case"cidr":return e=>e&&!(0,o.z8)(e)?l:void 0;case"mac":return e=>e&&!(0,o.iw)(e)?l:void 0;case"uuid":return p(l,/^[0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12}$/i);case"uuid3":return p(l,/^[0-9a-f]{8}-?[0-9a-f]{4}-?3[0-9a-f]{3}-?[0-9a-f]{4}-?[0-9a-f]{12}$/i);case"uuid4":return p(l,/^[0-9a-f]{8}-?[0-9a-f]{4}-?4[0-9a-f]{3}-?[89ab][0-9a-f]{3}-?[0-9a-f]{12}$/i);case"uuid5":return p(l,/^[0-9a-f]{8}-?[0-9a-f]{4}-?5[0-9a-f]{3}-?[89ab][0-9a-f]{3}-?[0-9a-f]{12}$/i);default:return}},m=e=>e||!1===e||!l()(e),h=function(e,t){return a=>{try{if(!a||!a.startsWith("v"))return e("validation.version");const r=i.QQ[t],l=d().parse(a);return r?r.includes(l?.build?.[0])?"":e("validation.version"):l?"":e("validation.version")}catch{return e("validation.version")}}},b=function(e){return v(e,{key:"Host"},"hostname")},k=function(e){return t=>t&&isNaN(t)?e("validation.port"):void 0},f=function(e){return v(e,{key:"Value"},"cidr")},y=function(e){return e.every((e=>(0,o.z8)(e)))},g=function(e){return t=>t&&!t.match(/^https?:\/\/(.*)$/)?e("validation.url"):void 0},C=function(e){return t=>t&&!t.match(/^v(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/)?e("validation.version"):void 0},N=function(e){return t=>t&&t.match(/^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$/)?void 0:e("validation.name")}},16005:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return it}});var r=a(9274);const l={key:1};function s(e,t,a,s,o,n){const i=(0,r.resolveComponent)("Loading"),c=(0,r.resolveComponent)("ClusterConfig"),d=(0,r.resolveComponent)("CruResource");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[o.loading?((0,r.openBlock)(),(0,r.createBlock)(i,{key:0})):((0,r.openBlock)(),(0,r.createElementBlock)("div",l,[o.preselectedClass?((0,r.openBlock)(),(0,r.createBlock)(c,{key:0,value:a.value,"initial-value":e.initialValue,"live-value":e.liveValue,mode:a.mode,"preselected-class":o.preselectedClass,"cluster-classes":o.clusterClasses,"onUpdate:value":t[0]||(t[0]=e=>n.set(a.value,e.k,e.val))},null,8,["value","initial-value","live-value","mode","preselected-class","cluster-classes"])):((0,r.openBlock)(),(0,r.createBlock)(d,{key:1,mode:a.mode,"validation-passed":!0,resource:a.value,errors:e.errors,"cancel-event":!0,"prevent-enter-submit":!0,class:"create-cluster",onFinish:e.save,onCancel:n.cancel,onError:t[2]||(t[2]=t=>e.errors=t)},{"form-footer":(0,r.withCtx)((()=>t[3]||(t[3]=[(0,r.createElementVNode)("div",null,null,-1)]))),default:(0,r.withCtx)((()=>[(0,r.createVNode)(c,{value:a.value,"initial-value":e.initialValue,"live-value":e.liveValue,mode:a.mode,"cluster-classes":o.clusterClasses,"onUpdate:value":t[1]||(t[1]=e=>n.set(a.value,e.k,e.val))},null,8,["value","initial-value","live-value","mode","cluster-classes"])])),_:1},8,["mode","resource","errors","onFinish","onCancel"]))]))])}var o=a(14220),n=a(76978),i=a(5742),c=a(29822),d=a(9323),u=a(24850);const p={class:"row mb-20"},v={class:"col span-3"},m={class:"col"},h={class:"mt-20 block"},b={class:"mt-20 block"},k={class:"row mb-20"},f={key:0,class:"col span-3"},y={key:1,class:"col span-3"};function g(e,t,a,l,s,o){const n=(0,r.resolveComponent)("CardGrid"),i=(0,r.resolveComponent)("NameNsDescription"),c=(0,r.resolveComponent)("t"),d=(0,r.resolveComponent)("LabeledInput"),u=(0,r.resolveComponent)("ControlPlaneEndpointSection"),g=(0,r.resolveComponent)("NetworkSection"),C=(0,r.resolveComponent)("WorkerItem"),N=(0,r.resolveComponent)("ClusterClassVariables"),w=(0,r.resolveComponent)("CruResource");return(0,r.openBlock)(),(0,r.createBlock)(w,{mode:a.mode,"show-as-form":!0,resource:a.value,errors:e.errors,"validation-passed":!0,"cancel-event":!0,"done-route":e.doneRoute,"apply-hooks":e.applyHooks,steps:s.addSteps,"component-testid":"capi-cluster-create",onDone:o.done,onError:t[10]||(t[10]=t=>e.errors=t),onFinish:o.saveOverride,onCancel:o.cancel},{stepClusterClass:(0,r.withCtx)((()=>[(0,r.createVNode)(n,{rows:o.clusterClassOptions,"key-field":"id","name-field":"label","side-label-field":"tag",onClicked:o.clickedType},null,8,["rows","onClicked"])])),stepConfiguration:(0,r.withCtx)((()=>[e.isView?(0,r.createCommentVNode)("",!0):((0,r.openBlock)(),(0,r.createBlock)(i,{key:0,value:a.value,mode:a.mode,namespaced:!1,"name-label":"cluster.name.label","name-placeholder":"cluster.name.placeholder","description-label":"cluster.description.label","description-placeholder":"cluster.description.placeholder",rules:{name:e.fvGetAndReportPathRules("metadata.name")},"onUpdate:value":t[0]||(t[0]=t=>e.$emit("update:value",{k:"metadata",val:t.metadata}))},null,8,["value","mode","rules"])),(0,r.createElementVNode)("div",p,[(0,r.createElementVNode)("div",v,[(0,r.createElementVNode)("h2",null,[(0,r.createVNode)(c,{k:"capi.cluster.version.title"})]),(0,r.createVNode)(d,{value:a.value.spec.topology.version,mode:a.mode,"label-key":"cluster.kubernetesVersion.label",required:"",rules:e.fvGetAndReportPathRules("spec.topology.version"),"onUpdate:value":t[1]||(t[1]=t=>e.$emit("update:value",{k:"spec.topology.version",val:t}))},null,8,["value","mode","rules"])]),(0,r.createElementVNode)("div",m,[(0,r.createElementVNode)("h2",null,[(0,r.createVNode)(c,{k:"capi.cluster.controlPlaneEndpoint.title"})]),(0,r.createVNode)(u,{value:o.controlPlaneEndpoint,"onUpdate:value":[t[2]||(t[2]=e=>o.controlPlaneEndpoint=e),t[3]||(t[3]=t=>e.$emit("update:value",{k:"spec.controlPlaneEndpoint",val:t}))],mode:a.mode,rules:{host:e.fvGetAndReportPathRules("spec.controlPlaneEndpoint.host"),port:e.fvGetAndReportPathRules("spec.controlPlaneEndpoint.port")}},null,8,["value","mode","rules"])])]),(0,r.createElementVNode)("div",h,[(0,r.createElementVNode)("h2",null,[(0,r.createVNode)(c,{k:"capi.cluster.networking.title"})]),(0,r.createVNode)(g,{value:o.clusterNetwork,"onUpdate:value":[t[4]||(t[4]=e=>o.clusterNetwork=e),t[5]||(t[5]=t=>e.$emit("update:value",{k:"spec.clusterNetwork",val:t}))],mode:a.mode,rules:{serviceDomain:e.fvGetAndReportPathRules("spec.clusterNetwork.serviceDomain"),apiServerPort:e.fvGetAndReportPathRules("spec.clusterNetwork.apiServerPort"),pods:e.fvGetAndReportPathRules("spec.clusterNetwork.pods"),services:e.fvGetAndReportPathRules("spec.clusterNetwork.services")}},null,8,["value","mode","rules"])]),(0,r.createElementVNode)("div",b,[(0,r.createElementVNode)("h2",null,[(0,r.createVNode)(c,{k:"capi.cluster.workers.title"}),t[11]||(t[11]=(0,r.createElementVNode)("span",{class:"required"},"*",-1))]),(0,r.createElementVNode)("div",k,[o.machineDeploymentOptions?((0,r.openBlock)(),(0,r.createElementBlock)("div",f,[(0,r.createVNode)(C,{value:o.machineDeployments,mode:a.mode,title:e.t("capi.cluster.workers.machineDeployments.title"),"default-add-value":s.defaultWorkerAddValue,"class-options":o.machineDeploymentOptions,"initial-empty-row":!0,"onUpdate:value":t[6]||(t[6]=t=>e.$emit("update:value",{k:"spec.topology.workers.machineDeployments",val:t}))},null,8,["value","mode","title","default-add-value","class-options"])])):(0,r.createCommentVNode)("",!0),o.machinePoolOptions?((0,r.openBlock)(),(0,r.createElementBlock)("div",y,[(0,r.createVNode)(C,{value:o.machinePools,mode:a.mode,title:e.t("capi.cluster.workers.machinePools.title"),"default-add-value":s.defaultWorkerAddValue,"class-options":o.machinePoolOptions,"initial-empty-row":!0,"onUpdate:value":t[7]||(t[7]=t=>e.$emit("update:value",{k:"spec.topology.workers.machinePools",val:t}))},null,8,["value","mode","title","default-add-value","class-options"])])):(0,r.createCommentVNode)("",!0)])])])),stepVariables:(0,r.withCtx)((()=>[(0,r.createElementVNode)("h2",null,[(0,r.createVNode)(c,{k:"capi.cluster.variables.title"})]),(0,r.createVNode)(N,{value:a.value.spec.topology.variables,"cluster-class":s.clusterClassObj,onValidationPassed:t[8]||(t[8]=e=>s.variablesReady=e),"onUpdate:value":t[9]||(t[9]=t=>e.$emit("update:value",{k:"spec.topology.variables",val:t}))},null,8,["value","cluster-class"])])),_:1},8,["mode","resource","errors","done-route","apply-hooks","steps","onDone","onFinish","onCancel"])}var C=a(68851),N=a(97497),w=a(25888),V=a(77651);const E={class:"variables"};function x(e,t,a,l,s,o){const n=(0,r.resolveComponent)("Variable");return(0,r.openBlock)(),(0,r.createElementBlock)("div",E,[o.variableDefinitions&&o.variableDefinitions.length?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:0},(0,r.renderList)(o.variableDefinitions,((e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:`${e.name}`},[(0,r.createVNode)(n,{ref_for:!0,ref:`${e.name}-input`,variable:e,value:o.valueFor(e),"validate-required":!a.machineDeploymentClass&&!a.machinePoolClass,"onUpdate:value":t=>o.updateVariables(t,e),onValidationPassed:o.updateErrors},null,8,["variable","value","validate-required","onUpdate:value","onValidationPassed"]),o.newComponentType(e,t)?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:`${t}-${s.rerenderKey}`,class:"force-newline"})):(0,r.createCommentVNode)("",!0)],64)))),128)):(0,r.createCommentVNode)("",!0)])}var P=a(12784),S=a.n(P),B=a(92043);const A={class:"input-label"},$={key:0,class:"icon icon-sm icon-info"},D={key:1,class:"icon icon-warning"};function R(e,t,a,l,s,o){const n=(0,r.resolveDirective)("clean-tooltip");return o.componentForType?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:(0,r.normalizeClass)({wider:o.listComponent,"align-center":"checkbox-var"===o.componentForType?.name,[`${o.componentForType.name}`]:!0})},[o.componentForType?((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(o.componentForType.component),{key:0,value:a.value,label:a.variable.name,placeholder:o.schema.example,tooltip:o.schema.description,required:a.variable.required&&a.validateRequired,title:a.variable.name,options:o.variableOptions,rules:o.listComponent?[]:o.validationRules,type:"number"===o.schema.type||"integer"===o.schema.type?"number":"text","onUpdate:value":o.setValue},{title:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",A,[(0,r.createElementVNode)("span",null,[(0,r.createTextVNode)((0,r.toDisplayString)(a.variable.name)+" ",1),o.schema.description?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("i",$,null,512)),[[n,o.schema.description]]):(0,r.createCommentVNode)("",!0),o.isValid?(0,r.createCommentVNode)("",!0):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("i",D,null,512)),[[n,o.validationErrors.join(" ")]])])])])),_:1},40,["value","label","placeholder","tooltip","required","title","options","rules","type","onUpdate:value"])):(0,r.createCommentVNode)("",!0),t[0]||(t[0]=(0,r.createElementVNode)("div",{class:"flexbox-newline"},null,-1))],2)):(0,r.createCommentVNode)("",!0)}var O=a(46343),U=a.n(O),T=a(37459),q=a(95709),_=a(45329),F=a(79410),L=a(65359),I=a(13089),j={name:"CCVariable",emits:["validation-passed","update:value"],props:{variable:{type:Object,required:!0},value:{type:[String,Object,Boolean,Array,Number],default:()=>null},validateRequired:{type:Boolean,default:!0}},watch:{isValid(e){this.$emit("validation-passed",e)}},created(){this.isValid||this.$emit("validation-passed",!1)},computed:{...(0,L.L8)({t:"i18n/t"}),componentForType(){const{type:e}=this.schema;let t;if(this.variableOptions)t={component:F.A,name:"text-var"};else switch(e){case"object":t={component:q.A,name:"keyvalue-var"};break;case"array":t={component:_.A,name:"arraylist-var"};break;case"string":t={component:N.A,name:"text-var"};break;case"integer":t={component:N.A,name:"text-var"};break;case"number":t={component:N.A,name:"text-var"};break;case"boolean":t={component:T.A,name:"checkbox-var"};break;default:break}return t},schema(){return this.variable?.schema?.openAPIV3Schema},variableOptions(){const e=this.schema?.enum;return e&&e.length?e.map((e=>"object"===typeof e?JSON.stringify(e):e)):null},validationRules(){if(this.isDefaultValue)return[];const e=this.t,t=(0,I.qW)(e,{key:this.variable.name},this.schema),a=this.variable?.required;return a&&this.validateRequired&&t.push((t=>(0,I.O9)(t)?void 0:e("validation.required",{key:this.variable.name}))),t},isDefaultValue(){const e=this.schema.default;return void 0!==e&&U()(e,this.value)},isValid(){return!this.validationErrors.length},validationErrors(){return this.validationRules.reduce(((e,t)=>{const a=t(this.value);return a&&e.push(a),e}),[])},listComponent(){return"arraylist-var"===this.componentForType?.name||"keyvalue-var"===this.componentForType?.name}},methods:{setValue(e){let t=e;const{type:a}=this.schema;if("object"===a)try{t=JSON.parse(e)}catch{}this.$emit("update:value",t)}}},M=(a(23288),a(47433));const z=(0,M.A)(j,[["render",R],["__scopeId","data-v-72db663a"]]);var G=z,Z={name:"ClusterClassVariables",components:{Variable:G},emits:["validation-passed","update:value"],props:{clusterClass:{type:Object,default:()=>{}},value:{type:Array,default:()=>[]},machineDeploymentClass:{type:String,default:null},machinePoolClass:{type:String,default:null}},data(){return{errorCount:0,rerenderKey:(0,B.vx)()}},watch:{errorCount:{handler:S()((e=>{(void 0).$emit("validation-passed",!e)}),5)},variableDefinitions(e,t){this.updateVariableDefaults(e,t),this.$nextTick((()=>{this.rerenderKey=(0,B.vx)()}))}},created(){this.updateVariableDefaults(this.variableDefinitions,[])},computed:{variableDefinitions(){const e=this.clusterClass?.spec?.variables||[];if(!this.machineDeploymentClass&&!this.machinePoolClass)return e;const t=this.machineScopedJsonPatches.reduce(((e,t)=>{const a=t?.valueFrom?.variable;if(!a)return e;const r=a.split(/\.|\[/)[0];return"builtin"!==r&&e.push(r),e}),[]);return e.filter((e=>t.includes(e.name)))},machineScopedJsonPatches(){if(!this.machineDeploymentClass&&!this.machinePoolClass)return[];const e=[],t=this.machineDeploymentClass||this.machinePoolClass,a=this.machineDeploymentClass?"machineDeploymentClass":"machinePoolClass",r=this.clusterClass?.spec?.patches||[];return r.forEach((r=>{const l=r?.definitions||[];l.forEach((r=>{const l=r?.selector?.matchResources?.[a]?.names||[];l.includes(t)&&e.push(...r.jsonPatches)}))})),e}},methods:{valueFor(e){return(this.value.find((t=>t.name===e.name))||{}).value},updateVariables(e,t){const a=[...this.value],r=this.value.findIndex((e=>e.name===t.name));r>=0?a[r].value=e:a.push({value:e,name:t.name}),this.$emit("update:value",a)},updateVariableDefaults(e,t){const a=[...this.value].reduce(((a,r)=>{const l=(e||[]).find((e=>e.name===r.name));if(!l)return a;const s=(t||[]).find((e=>e.name===r.name))?.schema?.openAPIV3Schema?.default;void 0!==s&&r.value===s&&delete r.value;let o=l.schema?.openAPIV3Schema?.default;return"boolean"!==l.schema?.openAPIV3Schema?.type||o||(o=!1),void 0===o||r.value||(r.value=o),a.push(r),a}),[]);e.forEach((e=>{let t=e.schema?.openAPIV3Schema?.default;"boolean"!==e.schema?.openAPIV3Schema?.type||t||(t=!1),void 0===t||a.find((t=>t.name===e.name))||a.push({name:e.name,value:t})})),this.errorCount=0,this.$emit("update:value",a)},updateErrors(e){e?this.errorCount--:this.errorCount++},newComponentType(e,t){const a=this.$refs,r=a[`${e.name}-input`]?.[0]?.$el,l=a[`${this.variableDefinitions[t+1]?.name}-input`]?.[0]?.$el;return!!l&&r?._prevClass!==l._prevClass}}};a(92226);const W=(0,M.A)(Z,[["render",x],["__scopeId","data-v-2e888091"]]);var K=W;const H={key:0,class:"container"},Q=["data-testid","onClick"],J={key:1,class:"m-50 text-center"};function X(e,t,a,l,s,o){const n=(0,r.resolveComponent)("ClusterClassCard"),i=(0,r.resolveDirective)("t");return a.rows.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",H,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.rows,((e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:o.get(e,a.keyField),"data-testid":a.componentTestid+"-"+t,onClick:a=>o.select(e,t)},[(0,r.createVNode)(n,{value:e.obj,selected:e.selected},null,8,["value","selected"])],8,Q)))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",J,[(0,r.withDirectives)((0,r.createElementVNode)("h1",null,null,512),[[i,a.noDataKey]])]))}var Y=a(56005),ee=a.n(Y);const te={class:"card-wrap"},ae={class:"name"},re={class:"description"},le={class:"container"},se={class:"leftcol"},oe={class:"rightcol"};function ne(e,t,a,l,s,o){const n=(0,r.resolveComponent)("ClusterCardField");return(0,r.openBlock)(),(0,r.createElementBlock)("div",{class:(0,r.normalizeClass)(["cluster-card-container",{selected:!!a.selected}]),"data-testid":"cluster-class-card"},[(0,r.createElementVNode)("div",te,[(0,r.createElementVNode)("div",ae,(0,r.toDisplayString)(o.name),1),(0,r.createElementVNode)("div",re,[(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(o.description),1)]),(0,r.createElementVNode)("div",le,[(0,r.createElementVNode)("div",se,[(0,r.createVNode)(n,{value:o.controlPlaneName,name:e.t("capi.clusterClassCard.controlPlaneName")},null,8,["value","name"]),(0,r.createVNode)(n,{value:o.controlPlaneKind,name:e.t("capi.clusterClassCard.controlPlaneKind")},null,8,["value","name"]),(0,r.createVNode)(n,{value:o.controlPlaneNamespace,name:e.t("capi.clusterClassCard.controlPlaneNamespace")},null,8,["value","name"])]),(0,r.createElementVNode)("div",oe,[o.machineDeploymentsCount>0?((0,r.openBlock)(),(0,r.createBlock)(n,{key:0,value:o.machineDeploymentsList,name:e.t("capi.clusterClassCard.machineDeploymentsCount",{count:o.machineDeploymentsCount})},null,8,["value","name"])):(0,r.createCommentVNode)("",!0),o.machinePoolsCount>0?((0,r.openBlock)(),(0,r.createBlock)(n,{key:1,value:o.machinePoolsList,name:e.t("capi.clusterClassCard.machinePoolsCount",{count:o.machinePoolsCount})},null,8,["value","name"])):(0,r.createCommentVNode)("",!0)])])])],2)}const ie={class:"label"},ce={class:"text-label"},de={class:"value"};function ue(e,t,a,l,s,o){return(0,r.openBlock)(),(0,r.createElementBlock)("div",ie,[(0,r.createElementVNode)("div",ce,[(0,r.renderSlot)(e.$slots,"name",{},(()=>[(0,r.createTextVNode)((0,r.toDisplayString)(a.name),1)]),!0)]),(0,r.createElementVNode)("div",de,[(0,r.renderSlot)(e.$slots,"value",{},(()=>[(0,r.createTextVNode)((0,r.toDisplayString)(a.value),1)]),!0)])])}var pe={props:{name:{type:String,required:!0},value:{type:[Number,String,void 0],default:""}}};a(13523);const ve=(0,M.A)(pe,[["render",ue],["__scopeId","data-v-7407ec5d"]]);var me=ve,he={name:"ClusterClassCard",components:{ClusterCardField:me},props:{value:{type:Object,required:!0},selected:{type:Boolean,default:!1}},data(){return{cloneData:!0,errors:[]}},computed:{...(0,L.L8)({t:"i18n/t"}),name(){return this.value?.metadata?.name||""},description(){return this.value?.metadata?.annotations?.description||""},controlPlaneName(){return this.value?.spec?.controlPlane?.ref?.name},controlPlaneKind(){return this.value?.spec?.controlPlane?.ref?.kind},controlPlaneNamespace(){return this.value?.spec?.controlPlane?.ref?.namespace},machineDeploymentsCount(){return this.value?.spec?.workers?.machineDeployments?.length},machineDeploymentsList(){return this.value?.spec?.workers?.machineDeployments?.map((e=>e.class)).join(", ")||""},machinePoolsCount(){return this.value?.spec?.workers?.machinePools?.length},machinePoolsList(){return this.value?.spec?.workers?.machinePools?.map((e=>e.class)).join(", ")||""}}};a(47985);const be=(0,M.A)(he,[["render",ne],["__scopeId","data-v-2904248b"]]);var ke=be,fe={components:{ClusterClassCard:ke},name:"CardGrid",emits:["clicked"],props:{rows:{type:Array,required:!0},keyField:{type:String,default:"key"},noDataKey:{type:String,default:"sortableTable.noRows"},componentTestid:{type:String,default:"select-card-grid"}},methods:{get:n.Jt,select(e,t){this.resetSelected(),this.rows[t].selected=!0,this.$emit("clicked",e,t)},resetSelected(){this.rows.map((e=>{e.selected=!1}))},capitalize:ee()}};a(47253);const ye=(0,M.A)(fe,[["render",X],["__scopeId","data-v-01bc296c"]]);var ge=ye;const Ce={key:0,class:"clearfix"},Ne=["data-testid"],we={class:"value"},Ve={class:"col mt-20"},Ee={class:"col mt-20"},xe={key:0,class:"remove"},Pe=["disabled","data-testid","onClick"],Se={key:2,class:"text-muted"},Be={key:3},Ae={key:4,class:"footer"},$e=["disabled"],De={key:0,class:"mr-5 icon icon-spinner icon-spin icon-lg"};function Re(e,t,a,l,s,o){const n=(0,r.resolveComponent)("LabeledInput"),i=(0,r.resolveComponent)("LabeledSelect");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[a.title?((0,r.openBlock)(),(0,r.createElementBlock)("div",Ce,[(0,r.renderSlot)(e.$slots,"title",{},(()=>[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(a.title),1)]))])):(0,r.createCommentVNode)("",!0),s.rows.length?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:1},(0,r.renderList)(s.rows,((t,l)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:l,"data-testid":`array-list-box${l}`,class:"box"},[(0,r.renderSlot)(e.$slots,"columns",{queueUpdate:e.queueUpdate,i:l,rows:s.rows,row:t,mode:a.mode,isView:o.isView},(()=>[(0,r.createElementVNode)("div",we,[(0,r.renderSlot)(e.$slots,"value",{row:t,mode:a.mode,isView:o.isView,queueUpdate:e.queueUpdate},(()=>[(0,r.createElementVNode)("div",Ve,[(0,r.createVNode)(n,{ref_for:!0,ref:"value",value:t.value.name,"onUpdate:value":e=>t.value.name=e,mode:a.mode,disabled:!1,label:e.t("capi.cluster.workers.name")},null,8,["value","onUpdate:value","mode","label"])]),(0,r.createElementVNode)("div",Ee,[(0,r.createVNode)(i,{value:t.value.class,"onUpdate:value":e=>t.value.class=e,mode:a.mode,options:a.classOptions,"label-key":"capi.cluster.workers.class"},null,8,["value","onUpdate:value","mode","options"])])])),a.removeAllowed?((0,r.openBlock)(),(0,r.createElementBlock)("div",xe,[(0,r.renderSlot)(e.$slots,"remove-button",{remove:()=>o.remove(t,l),i:l,row:t},(()=>[(0,r.createElementVNode)("button",{type:"button",disabled:o.isView,class:"btn role-link","data-testid":`remove-item-${l}`,onClick:e=>o.remove(t,l)},(0,r.toDisplayString)(o.removeLabel),9,Pe)]))])):(0,r.createCommentVNode)("",!0)])]))],8,Ne)))),128)):"view"===a.mode?((0,r.openBlock)(),(0,r.createElementBlock)("div",Se," — ")):((0,r.openBlock)(),(0,r.createElementBlock)("div",Be,[(0,r.renderSlot)(e.$slots,"empty")])),a.addAllowed&&!o.isView?((0,r.openBlock)(),(0,r.createElementBlock)("div",Ae,[a.addAllowed?(0,r.renderSlot)(e.$slots,"add",{key:0,add:o.add},(()=>[(0,r.createElementVNode)("button",{type:"button",class:"btn role-tertiary add",disabled:a.loading,"data-testid":"array-list-button",onClick:t[0]||(t[0]=e=>o.add())},[a.loading?((0,r.openBlock)(),(0,r.createElementBlock)("i",De)):(0,r.createCommentVNode)("",!0),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(o.addLabel),1)],8,$e)])):(0,r.createCommentVNode)("",!0)])):(0,r.createCommentVNode)("",!0)])}var Oe={components:{LabeledSelect:F.A,LabeledInput:N.A},emits:["add","remove","update:value"],props:{value:{type:Array,default:null},mode:{type:String,default:o.G5},title:{type:String,required:!0},classOptions:{type:Array,default:null},addAllowed:{type:Boolean,default:!0},removeAllowed:{type:Boolean,default:!0},defaultAddValue:{type:[String,Number,Object,Array],default:""},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data(){const e=(this.value||[])?.slice(),t=[];for(const a of e)t.push({value:a});if(!t.length){const e=this.defaultAddValue?(0,n.o8)(this.defaultAddValue):"";t.push({value:e})}return{rows:t,lastUpdateWasFromValue:!1}},computed:{isView(){return this.mode===o.nW},removeLabel(){return this.$store.getters["i18n/t"]("generic.remove")},addLabel(){return this.$store.getters["i18n/t"]("generic.add")}},watch:{value:{deep:!0,handler(){this.lastUpdateWasFromValue=!0,this.rows=(this.value||[]).map((e=>({value:e})))}},rows:{deep:!0,handler(){this.lastUpdateWasFromValue||this.queueUpdate(),this.lastUpdateWasFromValue=!1}}},created(){this.queueUpdate=S()(this.update,50)},methods:{add(){this.rows.push({value:(0,n.o8)(this.defaultAddValue)}),this.defaultAddValue&&this.queueUpdate(),this.$nextTick((()=>{const e=this.$refs.value;e&&e.length>0&&e[e.length-1].focus(),this.$emit("add")}))},remove(e,t){this.$emit("remove",{row:e,index:t}),(0,C.Wq)(this.rows,t),this.queueUpdate()},update(){if(this.isView)return;const e=[];for(const t of this.rows){const a=t.value;"undefined"!==typeof a&&e.push(a)}this.$emit("update:value",e)},valUpdate(e,t){t.value.name=e.data}}};const Ue=(0,M.A)(Oe,[["render",Re]]);var Te=Ue;const qe={class:"row mb-20"},_e={class:"col span-3"},Fe={class:"col span-3"},Le={class:"row mb-20"},Ie={class:"col span-3"},je={class:"col span-3"};function Me(e,t,a,l,s,o){const n=(0,r.resolveComponent)("LabeledInput"),i=(0,r.resolveComponent)("ArrayList");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.createElementVNode)("div",qe,[(0,r.createElementVNode)("div",_e,[(0,r.createVNode)(n,{value:a.value.apiServerPort,"onUpdate:value":t[0]||(t[0]=e=>a.value.apiServerPort=e),mode:a.mode,disabled:o.clusterIsAlreadyCreated,label:e.t("capi.cluster.networking.apiServerPort"),rules:a.rules.apiServerPort,required:""},null,8,["value","mode","disabled","label","rules"])]),(0,r.createElementVNode)("div",Fe,[(0,r.createVNode)(n,{value:a.value.serviceDomain,"onUpdate:value":t[1]||(t[1]=e=>a.value.serviceDomain=e),mode:a.mode,disabled:o.clusterIsAlreadyCreated,label:e.t("capi.cluster.networking.serviceDomain"),rules:a.rules.serviceDomain},null,8,["value","mode","disabled","label","rules"])])]),(0,r.createElementVNode)("div",Le,[(0,r.createElementVNode)("div",Ie,[(0,r.createVNode)(i,{value:a.value.pods.cidrBlocks,"onUpdate:value":t[2]||(t[2]=e=>a.value.pods.cidrBlocks=e),protip:!1,mode:a.mode,title:e.t("capi.cluster.networking.pods"),"value-placeholder":e.t("capi.cluster.networking.cidrplaceholder"),rules:a.rules.pods},null,8,["value","mode","title","value-placeholder","rules"])]),(0,r.createElementVNode)("div",je,[(0,r.createVNode)(i,{value:a.value.services.cidrBlocks,"onUpdate:value":t[3]||(t[3]=e=>a.value.services.cidrBlocks=e),protip:!1,mode:a.mode,title:e.t("capi.cluster.networking.services"),"value-placeholder":e.t("capi.cluster.networking.cidrplaceholder"),rules:a.rules.services},null,8,["value","mode","title","value-placeholder","rules"])])])])}var ze={name:"NetworkSelection",components:{LabeledInput:N.A,ArrayList:_.A},props:{value:{type:Object,required:!0},mode:{type:String,required:!0},rules:{default:()=>({serviceDomain:[],apiServerPort:[],pods:[],services:[]}),type:Object}},computed:{...(0,L.L8)({t:"i18n/t"}),clusterIsAlreadyCreated(){return this.mode===o.G5}}};const Ge=(0,M.A)(ze,[["render",Me]]);var Ze=Ge;const We={class:"row mb-20"},Ke={class:"col"},He={class:"col"};function Qe(e,t,a,l,s,o){const n=(0,r.resolveComponent)("LabeledInput");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.createElementVNode)("div",We,[(0,r.createElementVNode)("div",Ke,[(0,r.createVNode)(n,{value:a.value.host,"onUpdate:value":t[0]||(t[0]=e=>a.value.host=e),mode:a.mode,disabled:o.clusterIsAlreadyCreated,label:e.t("capi.cluster.controlPlaneEndpoint.host"),rules:a.rules.host},null,8,["value","mode","disabled","label","rules"])]),(0,r.createElementVNode)("div",He,[(0,r.createVNode)(n,{value:a.value.port,"onUpdate:value":t[1]||(t[1]=e=>a.value.port=e),mode:a.mode,disabled:o.clusterIsAlreadyCreated,label:e.t("capi.cluster.controlPlaneEndpoint.port"),rules:a.rules.port,type:"number"},null,8,["value","mode","disabled","label","rules"])])])])}var Je={name:"ControlPlaneEndpointSection",components:{LabeledInput:N.A},emits:["update:value"],props:{value:{type:Object,required:!0},mode:{type:String,required:!0},rules:{default:()=>({host:[],port:[]}),type:Object}},computed:{...(0,L.L8)({t:"i18n/t"}),clusterIsAlreadyCreated(){return this.mode===o.G5}}};const Xe=(0,M.A)(Je,[["render",Qe]]);var Ye=Xe;const et={version:"",class:"",workers:{machineDeployments:[],machinePools:[]}},tt={apiServerPort:6443,pods:{cidrBlocks:[]},serviceDomain:"",services:{cidrBlocks:[]}},at={host:"",port:49152};var rt={name:"ClusterConfig",components:{CruResource:d.A,NameNsDescription:w.A,LabeledInput:N.A,WorkerItem:Te,NetworkSection:Ze,ControlPlaneEndpointSection:Ye,ClusterClassVariables:K,CardGrid:ge},mixins:[i.A,V.A],emits:["update:value"],props:{mode:{type:String,required:!0},value:{type:Object,required:!0},preselectedClass:{type:String,required:!1,default:""},clusterClasses:{type:Array,required:!0}},beforeMount(){this.initSpecs(),this.$nextTick((()=>{this.loading=!1}))},data(){const e=this.$store,t=e.getters["i18n/t"],a={name:"stepClusterClass",title:t("capi.cluster.steps.clusterClass.title"),label:t("capi.cluster.steps.clusterClass.label"),subtext:"",descriptionKey:"capi.cluster.steps.clusterClass.description",ready:!1,weight:30},r={name:"stepConfiguration",title:t("capi.cluster.steps.configuration.title"),label:t("capi.cluster.steps.configuration.label"),subtext:"",descriptionKey:"capi.cluster.steps.configuration.description",ready:!1,weight:30},l={name:"stepVariables",title:t("capi.cluster.steps.variables.title"),label:t("capi.cluster.steps.variables.label"),subtext:"",descriptionKey:"capi.cluster.steps.variables.description",ready:!0,weight:30},s=this.preselectedClass?[r,l]:[a,r,l];return{addSteps:s,fvFormRuleSets:[{path:"metadata.name",rules:["required"]},{path:"spec.topology.version",rules:["required","version"]},{path:"spec.controlPlaneEndpoint.host",rules:["host"]},{path:"spec.controlPlaneEndpoint.port",rules:["port"]},{path:"spec.clusterNetwork.serviceDomain",rules:["host"]},{path:"spec.clusterNetwork.apiServerPort",rules:["required","port"]},{path:"spec.clusterNetwork.pods",rules:["cidr"]},{path:"spec.clusterNetwork.services",rules:["cidr"]}],credentialId:"",credential:null,versionInfo:{},defaultWorkerAddValue:{name:"",class:""},variablesReady:!0,clusterClassObj:null,loading:!0}},watch:{clusterClassObj(e){const t=this.addSteps.find((e=>"stepClusterClass"===e.name));t&&(t.ready=!!e)},stepConfigurationRequires(e){const t=this.addSteps.find((e=>"stepConfiguration"===e.name));t.ready=!!e},variablesReady(e){const t=this.addSteps.find((e=>"stepVariables"===e.name));t.ready=!!e}},computed:{fvExtraRules(){return{version:(0,I.tn)(this.$store.getters["i18n/t"],this.controlPlane),host:(0,I.l1)(this.$store.getters["i18n/t"]),port:(0,I.Q3)(this.$store.getters["i18n/t"]),cidr:(0,I.z0)(this.$store.getters["i18n/t"])}},stepConfigurationRequires(){const e=!!this.value.metadata.name,t=this.$store.getters["i18n/t"],a=this.value?.spec?.topology?.version&&!(0,I.tn)(t,this.controlPlane)(this.value?.spec?.topology?.version),r=!(0,I.Q3)(t)(this.value?.spec?.controlPlaneEndpoint?.port),l=!(0,I.l1)(t)(this.value?.spec?.controlPlaneEndpoint?.host),s=this.value?.spec?.topology?.workers?.machineDeployments?.length>0&&!!this.value?.spec?.topology?.workers?.machineDeployments[0]?.name&&!!this.value?.spec?.topology?.workers?.machineDeployments[0]?.class,o=this.value?.spec?.topology?.workers?.machinePools?.length>0&&!!this.value?.spec?.topology?.workers?.machinePools[0]?.name&&!!this.value?.spec?.topology?.workers?.machinePools[0]?.class,n=!this.value?.spec?.clusterNetwork?.pods?.cidrBlocks||(0,I.Eg)(this.value.spec.clusterNetwork.pods.cidrBlocks),i=!this.value?.spec?.clusterNetwork?.services?.cidrBlocks||(0,I.Eg)(this.value.spec.clusterNetwork.services.cidrBlocks),c=!!this.value?.spec?.clusterNetwork?.apiServerPort&&!isNaN(this.value?.spec?.clusterNetwork?.apiServerPort)&&n&&i;return e&&a&&l&&r&&c&&(s||o)},clusterNetwork(){return this.value?.spec?.clusterNetwork},controlPlaneEndpoint(){return this.value?.spec?.controlPlaneEndpoint},machineDeployments(){return this.value.spec.topology.workers.machineDeployments},machinePools(){return this.value.spec.topology.workers.machinePools},machineDeploymentOptions(){return this.clusterClassObj?.spec?.workers?.machineDeployments?.map((e=>e.class))},machinePoolOptions(){return this.clusterClassObj?.spec?.workers?.machinePools?.map((e=>e.class))},controlPlane(){return this.clusterClassObj?.spec?.controlPlane?.ref?.kind},clusterClassOptions(){const e=[],t=this.clusterClassObj;return this.clusterClasses.forEach((e=>{a(e)})),e;function a(a){const r=a?.id,l={id:r,obj:a,selected:t===a};e.push(l)}}},methods:{set:n.hZ,setClassInfo(e){this.clusterClassObj=this.clusterClasses.find((t=>{const a=unescape(e).split("/");return t.metadata.namespace===a[0]&&t.metadata.name===a[1]}))||null,this.clusterClassObj?(this.setClass(),this.setNamespace()):this.errors.push(this.t("error.clusterClassNotFound"))},setClass(){const e=this.clusterClassObj?.metadata?.name;this.$emit("update:value",{k:"spec.topology.class",val:e})},setNamespace(){const e=this.clusterClassObj?.metadata?.namespace;this.$emit("update:value",{k:"metadata.namespace",val:e})},async saveOverride(){this.errors&&(0,C.IU)(this.errors);try{return await this.value.save(),this.done()}catch(e){this.errors.push(e)}},initSpecs(){const e=this.value;e||(0,n.hZ)(e,"spec",{}),e.spec.topology||(0,n.hZ)(e.spec,"topology",(0,n.o8)(et)),e.spec.clusterNetwork||(0,n.hZ)(e.spec,"clusterNetwork",(0,n.o8)(tt)),e.spec.controlPlaneEndpoint||(0,n.hZ)(e.spec,"controlPlaneEndpoint",(0,n.o8)(at)),this.$emit("update:value",{k:"spec",val:e.spec}),this.preselectedClass&&this.setClassInfo(this.preselectedClass)},cancelCredential(){this.$refs.cruresource&&this.$refs.cruresource.emitOrRoute()},cancel(){this.$router.push({name:"c-cluster-manager-capi",params:{}})},done(){this.$router.push({name:"c-cluster-manager-capi",params:{}})},clickedType(e){this.clusterClassObj=this.clusterClasses.find((t=>t.id===e.id))||null,this.setClass(),this.setNamespace()}}};a(49015);const lt=(0,M.A)(rt,[["render",g],["__scopeId","data-v-42576d08"]]);var st=lt,ot={name:"CreateCluster",components:{CruResource:d.A,Loading:c.A,ClusterConfig:st},emits:["update:value"],mixins:[i.A],props:{value:{type:Object,default:null},componentTestid:{type:String,default:"capi-provider-create"},mode:{type:String,required:!0}},beforeMount(){this.value.spec||(0,n.hZ)(this.value,"spec",{}),this.value.id||this.value.metadata||(0,n.hZ)(this.value,"metadata",{}),this.getClusterClasses().then((e=>{this.clusterClasses=e,this.loading=!1})).catch((e=>{this.errors.push(e),this.loading=!1}))},data(){const e=this.$route,t=e.query[o.UA]||null,a=e.query[u.uB.CLASS],r=this.value?.spec?.topology?.class,l=this.value?.metadata?.namespace,s=l&&r?escape(`${l}/${r}`):null,n=a||s||null;return{subType:t,preselectedClass:n,capiProviders:[],clusterClasses:[],loading:!0}},methods:{set:n.hZ,async getClusterClasses(){const e=await this.$store.dispatch("management/findAll",{type:u.qt.CLUSTER_CLASS});return e},cancel(){this.$router.push({name:"c-cluster-manager-capi",params:{}})}}};const nt=(0,M.A)(ot,[["render",s]]);var it=nt},91254:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ee}});var r=a(9274);const l={class:"mb-20",style:{width:"100%"}};function s(e,t,a,s,o,n){const i=(0,r.resolveComponent)("SelectIconGrid"),c=(0,r.resolveComponent)("ProviderConfig"),d=(0,r.resolveComponent)("CruResource");return(0,r.openBlock)(),(0,r.createBlock)(d,{mode:e.mode,"validation-passed":!0,"selected-subtype":o.subType,resource:a.value,errors:e.errors,subtypes:n.subTypes,"cancel-event":!0,"prevent-enter-submit":!0,class:"create-cluster",onFinish:e.save,onCancel:e.done,onSelectType:n.selectType,onError:t[1]||(t[1]=t=>e.errors=t)},(0,r.createSlots)({subtypes:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",l,[(0,r.createVNode)(i,{rows:n.subTypes,"key-field":"id","name-field":"label","side-label-field":"tag",onClicked:n.clickedType},null,8,["rows","onClicked"])])])),default:(0,r.withCtx)((()=>[o.subType?((0,r.openBlock)(),(0,r.createBlock)(c,{key:0,value:a.value,"initial-value":e.initialValue,"live-value":e.liveValue,mode:e.mode,provider:o.subType,"onUpdate:value":t[0]||(t[0]=e=>n.set(a.value,e.k,e.val))},null,8,["value","initial-value","live-value","mode","provider"])):(0,r.createCommentVNode)("",!0)])),_:2},[o.subType?{name:"form-footer",fn:(0,r.withCtx)((()=>[t[2]||(t[2]=(0,r.createElementVNode)("div",null,null,-1))])),key:"0"}:void 0]),1032,["mode","selected-subtype","resource","errors","subtypes","onFinish","onCancel","onSelectType"])}var o=a(5742),n=a(9323),i=a(1987),c=a(14220),d=a(24850);const u={key:0},p={class:"row mb-20"},v={class:"col span-3"},m={class:"col span-3"},h={class:"col span-3"},b={class:"row mb-40"},k={class:"col span-6"},f={key:1,class:"mb-40"},y={key:2,class:"mb-20"},g={key:3},C={class:"mb-20"},N={key:4},w={key:1,class:"mb-40"},V={class:"mb-20"},E={key:2};function x(e,t,a,l,s,o){const n=(0,r.resolveComponent)("Loading"),i=(0,r.resolveComponent)("NameNsDescription"),c=(0,r.resolveComponent)("LabeledInput"),d=(0,r.resolveComponent)("LabeledSelect"),x=(0,r.resolveComponent)("t"),P=(0,r.resolveComponent)("SelectCredential"),S=(0,r.resolveComponent)("Banner"),B=(0,r.resolveComponent)("Checkbox"),A=(0,r.resolveComponent)("KeyValue"),$=(0,r.resolveComponent)("CruResource");return s.loading?((0,r.openBlock)(),(0,r.createBlock)(n,{key:0})):((0,r.openBlock)(),(0,r.createBlock)($,{key:1,ref:"providercruresource","can-yaml":!1,mode:a.mode,"validation-passed":e.fvFormIsValid,resource:a.value,errors:e.fvUnreportedValidationErrors,"cancel-event":!0,"done-route":e.doneRoute,"apply-hooks":e.applyHooks,class:"provider","component-testid":"capi-provider-create",onDone:e.done,onFinish:o.saveOverride,onCancel:e.done,onError:t[13]||(t[13]=t=>e.errors=t)},(0,r.createSlots)({default:(0,r.withCtx)((()=>[(0,r.createVNode)(i,{value:a.value,mode:a.mode,namespaced:!0,"namespace-options":s.allNamespaces,"namespace-new-allowed":!0,"name-label":"capi.provider.name.label","name-placeholder":"capi.provider.name.placeholder","description-label":"capi.provider.description.label","description-placeholder":"capi.provider.description.placeholder",rules:{name:e.fvGetAndReportPathRules("metadata.name")},"onUpdate:value":t[0]||(t[0]=t=>e.$emit("update:value",{k:"metadata",val:t.metadata}))},null,8,["value","mode","namespace-options","rules"]),o.isCustom?((0,r.openBlock)(),(0,r.createElementBlock)("div",u,[(0,r.createElementVNode)("div",p,[(0,r.createElementVNode)("div",v,[(0,r.createVNode)(c,{value:a.value.spec.name,mode:a.mode,"label-key":"capi.provider.label","placeholder-key":"capi.provider.placeholder",required:"",rules:e.fvGetAndReportPathRules("spec.name"),"onUpdate:value":t[1]||(t[1]=t=>e.$emit("update:value",{k:"spec.name",val:t}))},null,8,["value","mode","rules"])]),(0,r.createElementVNode)("div",m,[(0,r.createVNode)(d,{value:a.value.spec.type,mode:a.mode,options:o.typeOptions,"label-key":"capi.provider.type.label",disabled:o.isEdit,required:"","onUpdate:value":t[2]||(t[2]=t=>e.$emit("update:value",{k:"spec.type",val:t}))},null,8,["value","mode","options","disabled"])]),(0,r.createElementVNode)("div",h,[(0,r.createVNode)(c,{value:a.value.spec.version,mode:a.mode,"label-key":"capi.provider.version.label","placeholder-key":"capi.provider.version.placeholder",tooltip:e.t("capi.provider.version.tooltip"),rules:e.fvGetAndReportPathRules("spec.version"),"onUpdate:value":t[3]||(t[3]=t=>e.$emit("update:value",{k:"spec.version",val:t}))},null,8,["value","mode","tooltip","rules"])])]),(0,r.createElementVNode)("div",b,[(0,r.createElementVNode)("div",k,[(0,r.createVNode)(c,{value:a.value.spec.fetchConfig.url,mode:a.mode,"label-key":"capi.provider.fetchConfigURL.label","placeholder-key":"capi.provider.fetchConfigURL.placeholder",rules:e.fvGetAndReportPathRules("spec.fetchConfig.url"),"onUpdate:value":t[4]||(t[4]=t=>e.$emit("update:value",{k:"spec.fetchConfig.url",val:t}))},null,8,["value","mode","rules"])])])])):(0,r.createCommentVNode)("",!0),s.credentialComponent?((0,r.openBlock)(),(0,r.createElementBlock)("div",f)):(0,r.createCommentVNode)("",!0),o.hasFeatures||o.hasVariables?((0,r.openBlock)(),(0,r.createElementBlock)("h2",y,[(0,r.createVNode)(x,{k:"capi.provider.secret.title"})])):(0,r.createCommentVNode)("",!0),s.credentialComponent?((0,r.openBlock)(),(0,r.createElementBlock)("div",g,[(0,r.createElementVNode)("h3",C,[(0,r.createVNode)(x,{k:"capi.provider.cloudCredential.title"})]),(0,r.createVNode)(P,{value:a.value.spec.credentials.rancherCloudCredentialNamespaceName,"onUpdate:value":[t[5]||(t[5]=e=>a.value.spec.credentials.rancherCloudCredentialNamespaceName=e),t[6]||(t[6]=t=>e.$emit("update:value",{k:"spec.credentials.rancherCloudCredentialNamespaceName",val:t}))],mode:a.mode,provider:s.credentialComponent,cancel:o.cancelCredential,"showing-form":o.showForm,class:"mb-40"},null,8,["value","mode","provider","cancel","showing-form"])])):(0,r.createCommentVNode)("",!0),o.waitingForCredential?(0,r.createCommentVNode)("",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",N,[o.shouldShowBanner?((0,r.openBlock)(),(0,r.createBlock)(S,{key:0,color:"info"},{default:(0,r.withCtx)((()=>[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("capi.provider.banner")),1)])),_:1})):(0,r.createCommentVNode)("",!0),o.hasFeatures?((0,r.openBlock)(),(0,r.createElementBlock)("div",w,[(0,r.createElementVNode)("h3",V,[(0,r.createVNode)(x,{k:"capi.provider.features.title"})]),(0,r.createVNode)(B,{value:a.value.spec.features.clusterResourceSet,mode:a.mode,label:e.t("capi.provider.features.clusterResourceSet"),"onUpdate:value":t[7]||(t[7]=t=>e.$emit("update:value",{k:"spec.features.clusterResourceSet",val:t}))},null,8,["value","mode","label"]),(0,r.createVNode)(B,{value:a.value.spec.features.clusterTopology,"onUpdate:value":[t[8]||(t[8]=e=>a.value.spec.features.clusterTopology=e),t[9]||(t[9]=t=>e.$emit("update:value",{k:"spec.features.clusterTopology",val:t}))],mode:a.mode,label:e.t("capi.provider.features.clusterTopology")},null,8,["value","mode","label"]),(0,r.createVNode)(B,{value:a.value.spec.features.machinePool,"onUpdate:value":[t[10]||(t[10]=e=>a.value.spec.features.machinePool=e),t[11]||(t[11]=t=>e.$emit("update:value",{k:"spec.features.machinePool",val:t}))],mode:a.mode,label:e.t("capi.provider.features.machinePool")},null,8,["value","mode","label"])])):(0,r.createCommentVNode)("",!0),o.hasVariables?((0,r.openBlock)(),(0,r.createElementBlock)("div",E,[(0,r.createElementVNode)("h3",null,[(0,r.createVNode)(x,{k:"capi.provider.variables.title"})]),(0,r.createVNode)(A,{value:a.value.spec.variables,"add-label":e.t("capi.provider.variables.add"),mode:a.mode,"value-can-be-empty":!0,"handle-base64":!1,"value-trim":!1,"add-allowed":!0,"read-allowed":!0,"parse-lines-from-file":!0,"onUpdate:value":t[12]||(t[12]=t=>e.$emit("update:value",{k:"spec.variables",val:t}))},null,8,["value","add-label","mode"])])):(0,r.createCommentVNode)("",!0)]))])),_:2},[o.waitingForCredential?{name:"form-footer",fn:(0,r.withCtx)((()=>[t[14]||(t[14]=(0,r.createElementVNode)("div",null,null,-1))])),key:"0"}:void 0]),1032,["mode","validation-passed","resource","errors","done-route","apply-hooks","onDone","onFinish","onCancel"]))}var P=a(65359),S=a(68851),B=a(35664),A=a(29822),$=a(96046),D=a(77651),R=a(37459),O=a(92043),U=a(76978),T=a(25888),q=a(95709),_=a(97497),F=a(79410),L=a(15820),I=a(88339),j=a(13089);const M={clusterResourceSet:!0,clusterTopology:!0,machinePool:!0},z={},G={name:"",type:"infrastructure",configSecret:{name:""},credentials:{rancherCloudCredentialNamespaceName:""}},Z={name:"",type:"infrastructure",configSecret:{name:""},credentials:{rancherCloudCredentialNamespaceName:""},fetchConfig:{url:""}},W=["infrastructure","bootstrap","controlPlane","addon","ipam","runtimeextension","core"];var K={name:"ProviderConfig",components:{CruResource:n.A,Loading:A.A,NameNsDescription:T.A,SelectCredential:$.A,Checkbox:R.A,KeyValue:q.A,LabeledInput:_.A,LabeledSelect:F.A,Banner:L.A},mixins:[o.A,D.A],emits:["update:value"],props:{mode:{type:String,required:!0},value:{type:Object,required:!0},provider:{type:String,required:!0}},beforeMount(){this.getDependencies().then((e=>{this.allNamespaces=e.namespaces||[],this.coreProviderSecret=e.coreProviderSecret||{},this.initSpecs(),this.loading=!1})).catch((e=>{this.errors.push(e),this.initSpecs(),this.loading=!1}))},data(){const e=d.MA.find((e=>e.id===this.provider))||{disabled:!1,id:"0"};return{loading:!0,fvFormRuleSets:[{path:"metadata.name",rules:["name"]},{path:"spec.name",rules:["required"]},{path:"spec.version",rules:["version"]},{path:"spec.fetchConfig.url",rules:["url"]}],allNamespaces:[],credentialComponent:e?.credential}},computed:{...(0,P.L8)(["namespaces"]),fvExtraRules(){return{name:(0,j.Vd)(this.$store.getters["i18n/t"]),version:(0,j.wU)(this.$store.getters["i18n/t"]),url:(0,j.IF)(this.$store.getters["i18n/t"])}},typeOptions(){return W.map((e=>({label:this.t(`capi.provider.type.${e}.label`),value:e})))},showForm(){return!!this.value.spec.credentials.rancherCloudCredentialNamespaceName||!this.credentialComponent},isEdit(){return this.mode===c.G5},hasFeatures(){return!!this.value?.spec?.features},hasVariables(){return!!this.value?.spec?.variables},isCustom(){return"custom"===this.provider},shouldShowBanner(){return this.isEdit&&(this.hasFeatures||this.hasVariables)},waitingForCredential(){return this.credentialComponent&&!this.value.spec.credentials.rancherCloudCredentialNamespaceName}},methods:{initSpecs(){if(!this.value.spec){const e=this.getSpecFromCoreSecret();"custom"!==this.provider?((0,U.hZ)(this.value,"spec",{...(0,U.o8)(G),...e}),(0,U.hZ)(this.value.spec,"name",this.provider)):(0,U.hZ)(this.value,"spec",{...(0,U.o8)(Z),...e})}this.value.spec.configSecret.name||(0,U.hZ)(this.value.spec.configSecret,"name",this.generateName(this.provider))},getSpecFromCoreSecret(){const e=this.coreProviderSecret?.data;if(e){const t=["EXP_CLUSTER_RESOURCE_SET","CLUSTER_TOPOLOGY","EXP_MACHINE_POOL"],a=(0,U.o8)(e);return t.forEach((e=>{delete a[e]})),{features:{clusterResourceSet:"dHJ1ZQ=="===e.EXP_CLUSTER_RESOURCE_SET,clusterTopology:"dHJ1ZQ=="===e.CLUSTER_TOPOLOGY,machinePool:"dHJ1ZQ=="===e.EXP_MACHINE_POOL},variables:a}}return{features:(0,U.o8)(M),variables:(0,U.o8)(z)}},generateName(e){return e?`${e}-credentials-${(0,O.vx)(5).toLowerCase()}`:void 0},async getDependencies(){const e=this.$store.getters["currentStore"](B.CU),{$store:t}=this,a={namespaces:t.dispatch(`${e}/findAll`,{type:B.CU}),coreProviderSecret:t.dispatch("management/find",{type:B.bB,id:`${d.Ch}/${d.s7}`,opt:{watch:!1,force:!0}})};return await(0,I.kR)(a)},async saveOverride(e){this.errors&&(0,S.IU)(this.errors),this.credentialComponent||this.value.spec?.credentials?.rancherCloudCredentialNamespaceName||(this.value.spec.credentials=null),""===this.value?.spec?.version&&delete this.value.spec.version;try{await this.save(e,null)}catch(t){this.errors.push(t),e(!1)}},cancelCredential(){this.$refs.providercruresource&&this.$refs.providercruresource.emitOrRoute()}}},H=a(47433);const Q=(0,H.A)(K,[["render",x]]);var J=Q,X={name:"CreateProvider",components:{CruResource:n.A,SelectIconGrid:i.A,ProviderConfig:J},mixins:[o.A],emits:["set-subtype","update:value"],props:{value:{type:Object,default:null},componentTestid:{type:String,default:"capi-provider-create"}},async beforeMount(){this.capiProviders=await this.$store.dispatch("management/findAll",{type:d.qt.PROVIDER});const e=this.value.spec?.name;e&&(this.value.spec?.fetchConfig&&!this.subTypes.find((({id:t})=>t===e))?this.selectType("custom"):this.selectType(e))},data(){const e=this.$route,t=e?.query[c.UA]||null;return{subType:t,capiProviders:[]}},computed:{subTypes(){const e=[],t=this.$store.getters;return d.MA?.forEach((e=>{const t=e.disabled||this.enabledProviderTypes.includes(e.id);r(e.id,t)})),e;function r(r,l=!1){const s=t["i18n/withFallback"](`cluster.provider."${r}"`,null,r),o=t["i18n/withFallback"](`cluster.providerDescription."${r}"`,null,"");let n;try{n=a(53588)(`./${r}.svg`)}catch(c){try{n=a(36283)(`./${r}.svg`)}catch(c){n=a(76251)}}const i={id:r,label:s,description:o,icon:n,disabled:l};e.push(i)}},enabledProviderTypes(){return this.capiProviders.reduce(((e,t)=>{const{name:a}=t?.spec||{};return e.includes(a)||"custom"===a||e.push(a),e}),[])}},methods:{set:U.hZ,clickedType(e){const t=e.id;this.$router?.applyQuery({[c.UA]:t}),this.selectType(t)},selectType(e){this.subType=e,this.$emit("set-subtype",this.$store.getters["i18n/withFallback"](`cluster.provider."${e}"`,null,e))}}};a(62868);const Y=(0,H.A)(X,[["render",s]]);var ee=Y},23288:function(e,t,a){var r=a(27288);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var l=a(74825).A;l("1f56cf00",r,!0,{sourceMap:!1,shadowMode:!1})},92226:function(e,t,a){var r=a(93282);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var l=a(74825).A;l("689fa95c",r,!0,{sourceMap:!1,shadowMode:!1})},47253:function(e,t,a){var r=a(32309);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var l=a(74825).A;l("0ccd8924",r,!0,{sourceMap:!1,shadowMode:!1})},13523:function(e,t,a){var r=a(94579);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var l=a(74825).A;l("0638f1ab",r,!0,{sourceMap:!1,shadowMode:!1})},47985:function(e,t,a){var r=a(39697);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var l=a(74825).A;l("1d7bb655",r,!0,{sourceMap:!1,shadowMode:!1})},49015:function(e,t,a){var r=a(1239);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var l=a(74825).A;l("d724baaa",r,!0,{sourceMap:!1,shadowMode:!1})},62868:function(e,t,a){var r=a(35124);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var l=a(74825).A;l("090e74d2",r,!0,{sourceMap:!1,shadowMode:!1})},53588:function(e,t,a){var r={"./aliyun-black.svg":87526,"./aliyun.svg":17180,"./aliyunecs-black.svg":75685,"./aliyunecs.svg":38683,"./amazonec2-black.svg":52212,"./amazonec2.svg":16598,"./amazoneks-black.svg":43881,"./amazoneks.svg":90287,"./aws.svg":59835,"./azure-black.svg":80895,"./azure.svg":60961,"./azuread-black.svg":81392,"./azuread.svg":45634,"./azureaks-black.svg":35894,"./azureaks.svg":40268,"./baidu-black.svg":71351,"./baidu.svg":47113,"./cloudca-black.svg":50309,"./cloudca.svg":23131,"./cloudscale-black.svg":51773,"./cloudscale.svg":86531,"./custom.svg":29181,"./digitalocean-black.svg":65988,"./digitalocean.svg":19110,"./equinix-black.svg":66335,"./equinix.svg":60705,"./exoscale.svg":12896,"./gcp.svg":2054,"./gke-black.svg":3405,"./gke.svg":61939,"./google.svg":32561,"./googlegke-black.svg":73562,"./googlegke.svg":97712,"./harvester.svg":53938,"./huaweicce-black.svg":91128,"./huaweicce.svg":40634,"./import.svg":28499,"./k3s-black.svg":35671,"./k3s.svg":85545,"./kubernetes-black.svg":27442,"./kubernetes.svg":9144,"./linode.svg":75553,"./linodelke-black.svg":96441,"./linodelke.svg":3199,"./local-cluster.svg":47600,"./minikube-black.svg":18152,"./minikube.svg":92746,"./nutanix.svg":70079,"./oci-black.svg":40097,"./oci.svg":46487,"./openstack-black.svg":57990,"./openstack.svg":53116,"./oracle.svg":88594,"./oracleoke-black.svg":56347,"./oracleoke.svg":9053,"./otc-black.svg":67294,"./otc.svg":69348,"./otccce.svg":24079,"./outscale.svg":72886,"./ovhcloudmks.svg":49619,"./ovhcloudpubliccloud.svg":54474,"./packet-black.svg":90742,"./packet.svg":48428,"./pinganyunecs-black.svg":49880,"./pinganyunecs.svg":58490,"./pnap-black.svg":59931,"./pnap.svg":31549,"./rackspace-black.svg":41511,"./rackspace.svg":65785,"./rke.svg":38102,"./rke2.svg":49560,"./softlayer.svg":61883,"./tencenttke-black.svg":70963,"./tencenttke.svg":77701,"./vmwarevsphere-black.svg":26791,"./vmwarevsphere.svg":5337};function l(e){var t=s(e);return a(t)}function s(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}l.keys=function(){return Object.keys(r)},l.resolve=s,e.exports=l,l.id=53588},36283:function(e,t,a){var r={"./docker.svg":17743,"./vsphere-black.svg":49038,"./vsphere.svg":37652};function l(e){var t=s(e);return a(t)}function s(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}l.keys=function(){return Object.keys(r)},l.resolve=s,e.exports=l,l.id=36283},17743:function(e,t,a){"use strict";e.exports=a.p+"img/docker.921780fa.svg"},49038:function(e,t,a){"use strict";e.exports=a.p+"img/vsphere-black.454d68ed.svg"},37652:function(e,t,a){"use strict";e.exports=a.p+"img/vsphere.94d59db3.svg"}}]);
//# sourceMappingURL=capi-0.8.3-rc1.umd.min.edit.js.map