(("undefined"!==typeof self?self:this)["webpackChunkcapi_0_8_1"]=("undefined"!==typeof self?self:this)["webpackChunkcapi_0_8_1"]||[]).push([[739],{64336:function(e,t,a){"use strict";a.r(t);var r=a(40429),o=a.n(r),s=a(1214),l=a.n(s),n=l()(o());n.push([e.id,'.align-center[data-v-3b0fd8d0]{align-self:"center"}.input-label[data-v-3b0fd8d0]{color:var(--input-label);margin-bottom:5px;display:block;width:100%}.input-label .icon-warning[data-v-3b0fd8d0]{color:var(--error)}',""]),t["default"]=n},83880:function(e,t,a){"use strict";a.r(t);var r=a(40429),o=a.n(r),s=a(1214),l=a.n(s),n=l()(o());n.push([e.id,".variables[data-v-6d8013eb]{display:flex;flex-direction:row;flex-wrap:wrap}.variables>*[data-v-6d8013eb]{flex:0 1 23.25%;margin:0 1.75% 10px 0;max-width:23.25%}.variables[data-v-6d8013eb]>.wider{flex:0 1 48.25%;max-width:48.25%}.variables>.force-newline[data-v-6d8013eb]{flex:1 0 100%;max-width:none}",""]),t["default"]=n},63118:function(e,t,a){"use strict";a.r(t);var r=a(40429),o=a.n(r),s=a(1214),l=a.n(s),n=l()(o());n.push([e.id,".container[data-v-78ececd0]{display:grid;grid-template-columns:1fr 1fr 1fr}@media only screen and (max-width:992px){.container[data-v-78ececd0]{grid-template-columns:1fr 1fr}}@media only screen and (max-width:1281px){.container[data-v-78ececd0]{grid-template-columns:1fr}}",""]),t["default"]=n},94579:function(e,t,a){"use strict";a.r(t);var r=a(40429),o=a.n(r),s=a(1214),l=a.n(s),n=l()(o());n.push([e.id,".label[data-v-7407ec5d]{display:flex;flex-direction:column;margin-bottom:10px}.label .text-label[data-v-7407ec5d]{font-size:12px;line-height:18px;color:var(--darker)}.label .value[data-v-7407ec5d]{line-height:18px}",""]),t["default"]=n},7560:function(e,t,a){"use strict";a.r(t);var r=a(40429),o=a.n(r),s=a(1214),l=a.n(s),n=l()(o());n.push([e.id,".cluster-card-container[data-v-6b5d8548]{display:flex;flex-basis:40%;margin:10px;min-height:100px;padding:10px 20px;height:90%;border:1px solid var(--border);border-radius:var(--border-radius)}.cluster-card-container.selected[data-v-6b5d8548]{border:2px solid var(--app-rancher-accent)}.cluster-card-container[data-v-6b5d8548]:hover{box-shadow:0 0 30px var(--shadow);transition:box-shadow .1s ease-in-out;cursor:pointer;text-decoration:none!important}.cluster-card-container.rancher .deploys-os-label[data-v-6b5d8548],.cluster-card-container.rancher .side-label[data-v-6b5d8548]{background-color:var(--app-rancher-accent)}.cluster-card-container.rancher .deploys-os-label label[data-v-6b5d8548],.cluster-card-container.rancher .side-label label[data-v-6b5d8548]{color:var(--app-rancher-accent-text)}.cluster-card-container.rancher[data-v-6b5d8548]:hover{border-color:var(--app-rancher-accent)}.cluster-card-container.partner .deploys-os-label[data-v-6b5d8548],.cluster-card-container.partner .side-label[data-v-6b5d8548]{background-color:var(--app-partner-accent)}.cluster-card-container.partner .deploys-os-label label[data-v-6b5d8548],.cluster-card-container.partner .side-label label[data-v-6b5d8548]{color:var(--app-partner-accent-text)}.cluster-card-container.partner[data-v-6b5d8548]:hover{border-color:var(--app-partner-accent)}.cluster-card-container .card-wrap[data-v-6b5d8548]{width:100%}.name[data-v-6b5d8548]{font-size:16px;font-weight:700;margin-bottom:10px}.description[data-v-6b5d8548]{font-size:14px;margin-bottom:20px}.container[data-v-6b5d8548]{display:grid;padding:0;grid-template-columns:1fr 1fr}@media only screen and (max-width:1281px){.container[data-v-6b5d8548]{grid-template-columns:1fr}}.leftcol[data-v-6b5d8548]{justify-self:start;margin-right:10px}.rightcol[data-v-6b5d8548]{justify-self:end}@media only screen and (max-width:1281px){.rightcol[data-v-6b5d8548]{justify-self:start}}",""]),t["default"]=n},93275:function(e,t,a){"use strict";a.r(t);var r=a(40429),o=a.n(r),s=a(1214),l=a.n(s),n=l()(o());n.push([e.id,".required[data-v-18d46140]{color:var(--error)}",""]),t["default"]=n},48214:function(e,t,a){"use strict";a.r(t);var r=a(40429),o=a.n(r),s=a(1214),l=a.n(s),n=l()(o());n.push([e.id,".grouped-type{position:relative}.rke-switch{margin-top:-10px;position:absolute;right:0}",""]),t["default"]=n},13089:function(e,t,a){"use strict";a.d(t,{Eg:function(){return k},IF:function(){return y},Lw:function(){return v},O9:function(){return p},Q3:function(){return f},Vd:function(){return C},l1:function(){return h},qW:function(){return c},tn:function(){return m},wU:function(){return g},z0:function(){return b}});var r=a(3514),o=a.n(r),s=a(92043),l=a(87898),n=a(56158),i=a(24850);const c=function(e,{key:t="Value"},a){const{exclusiveMinimum:r,exclusiveMaximum:o,maxItems:s,maxLength:l,maximum:n,minItems:i,minLength:c,minimum:p,pattern:v,uniqueItems:m,required:h,format:f}=a,b=[];return n&&(o?b.push((a=>Number(a)>=Number(n)?e("validation.exclusiveMaxValue",{key:t,maximum:n}):void 0)):b.push((a=>Number(a)>Number(n)?e("validation.maxValue",{key:t,max:n}):void 0))),void 0!==p&&(r?b.push((a=>Number(a)<=Number(p)?e("validation.exclusiveMinValue",{key:t,minimum:p}):void 0)):b.push((a=>Number(a)<Number(p)?e("validation.minValue",{key:t,min:p}):void 0))),void 0!==c&&b.push((a=>a&&a.length<Number(c)?e("validation.minLength",{key:t,min:c}):void 0)),l&&b.push((a=>a&&a.length>Number(l)?e("validation.maxLength",{key:t,max:l}):void 0)),s&&b.push((a=>a&&a.length>s?e("validation.maxItems",{key:t,maxItems:s}):void 0)),void 0!==i&&b.push((a=>a&&a.length<i?e("validation.minItems",{key:t,minItems:i}):void 0)),v&&b.push(d(e("validation.pattern",{key:t,pattern:v}),new RegExp(v))),f&&u(e,{key:t},f)&&b.push(u(e,{key:t},f)),m&&b.push((a=>a&&a.filter(((e,t)=>a.indexOf(e)!==t)).length?e("validation.uniqueItems",{key:t}):void 0)),h&&b.push((a=>h.find((e=>void 0===a[e]))?e("validation.requiredFields",{key:t,requiredFields:h.toString()}):void 0)),b},d=function(e,t){return a=>a&&!a.match(t)?e:void 0},u=function(e,{key:t="Value"},a){const r=(0,n.A)(e,{key:t}),o=e("validation.stringFormat",{key:t,format:a});switch(a){case"hostname":return e=>r.wildcardHostname(e);case"ipv4":return e=>e&&!(0,s.eH)(e)?o:void 0;case"cidr":return e=>e&&!(0,l.z8)(e)?o:void 0;case"mac":return e=>e&&!(0,l.iw)(e)?o:void 0;case"uuid":return d(o,/^[0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12}$/i);case"uuid3":return d(o,/^[0-9a-f]{8}-?[0-9a-f]{4}-?3[0-9a-f]{3}-?[0-9a-f]{4}-?[0-9a-f]{12}$/i);case"uuid4":return d(o,/^[0-9a-f]{8}-?[0-9a-f]{4}-?4[0-9a-f]{3}-?[89ab][0-9a-f]{3}-?[0-9a-f]{12}$/i);case"uuid5":return d(o,/^[0-9a-f]{8}-?[0-9a-f]{4}-?5[0-9a-f]{3}-?[89ab][0-9a-f]{3}-?[0-9a-f]{12}$/i);default:return}},p=e=>e||!1===e||!o()(e),v=function(e,t){let a="";return i.QQ[t]&&(a=`\\+(${i.QQ[t].join("|")})`),new RegExp(`^v(\\d+.){2}\\d+${a}$`)},m=function(e,t){const a=v(e,t);return d(e("validation.version"),a)},h=function(e){return u(e,{key:"Host"},"hostname")},f=function(e){return t=>t&&isNaN(t)?e("validation.port"):void 0},b=function(e){return u(e,{key:"Value"},"cidr")},k=function(e){return e.every((e=>(0,l.z8)(e)))},y=function(e){return t=>t&&!t.match(/^https?:\/\/(.*)$/)?e("validation.url"):void 0},g=function(e,t){return a=>t&&!a||a&&!a.match(/^v(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/)?e("validation.version"):void 0},C=function(e){return t=>t&&t.match(/^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$/)?void 0:e("validation.name")}},60917:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return vt}});var r=a(9274);const o={key:1},s=(0,r.createElementVNode)("div",null,null,-1);function l(e,t,a,l,n,i){const c=(0,r.resolveComponent)("Loading"),d=(0,r.resolveComponent)("ClusterConfig"),u=(0,r.resolveComponent)("CruResource");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[n.loading?((0,r.openBlock)(),(0,r.createBlock)(c,{key:0})):((0,r.openBlock)(),(0,r.createElementBlock)("div",o,[n.preselectedClass?((0,r.openBlock)(),(0,r.createBlock)(d,{key:0,value:a.value,"initial-value":e.initialValue,"live-value":e.liveValue,mode:a.mode,"preselected-class":n.preselectedClass,"cluster-classes":n.clusterClasses,"onUpdate:value":t[0]||(t[0]=e=>i.set(a.value,e.k,e.val))},null,8,["value","initial-value","live-value","mode","preselected-class","cluster-classes"])):((0,r.openBlock)(),(0,r.createBlock)(u,{key:1,mode:a.mode,"validation-passed":!0,resource:a.value,errors:e.errors,"cancel-event":!0,"prevent-enter-submit":!0,class:"create-cluster",onFinish:e.save,onCancel:i.cancel,onError:t[2]||(t[2]=t=>e.errors=t)},{"form-footer":(0,r.withCtx)((()=>[s])),default:(0,r.withCtx)((()=>[(0,r.createVNode)(d,{value:a.value,"initial-value":e.initialValue,"live-value":e.liveValue,mode:a.mode,"cluster-classes":n.clusterClasses,"onUpdate:value":t[1]||(t[1]=e=>i.set(a.value,e.k,e.val))},null,8,["value","initial-value","live-value","mode","cluster-classes"])])),_:1},8,["mode","resource","errors","onFinish","onCancel"]))]))])}var n=a(14220),i=a(76978),c=a(5742),d=a(29822),u=a(74920),p=a(24850);const v=e=>((0,r.pushScopeId)("data-v-18d46140"),e=e(),(0,r.popScopeId)(),e),m={class:"row mb-20"},h={class:"col span-3"},f={class:"col"},b={class:"mt-20 block"},k={class:"mt-20 block"},y=v((()=>(0,r.createElementVNode)("span",{class:"required"},"*",-1))),g={class:"row mb-20"},C={key:0,class:"col span-3"},N={key:1,class:"col span-3"};function w(e,t,a,o,s,l){const n=(0,r.resolveComponent)("CardGrid"),i=(0,r.resolveComponent)("NameNsDescription"),c=(0,r.resolveComponent)("t"),d=(0,r.resolveComponent)("LabeledInput"),u=(0,r.resolveComponent)("ControlPlaneEndpointSection"),p=(0,r.resolveComponent)("NetworkSection"),v=(0,r.resolveComponent)("WorkerItem"),w=(0,r.resolveComponent)("ClusterClassVariables"),V=(0,r.resolveComponent)("CruResource");return(0,r.openBlock)(),(0,r.createBlock)(V,{mode:a.mode,"show-as-form":!0,resource:a.value,errors:e.errors,"validation-passed":!0,"cancel-event":!0,"done-route":e.doneRoute,"apply-hooks":e.applyHooks,steps:s.addSteps,"component-testid":"capi-cluster-create",onDone:l.done,onError:t[10]||(t[10]=t=>e.errors=t),onFinish:l.saveOverride,onCancel:l.cancel},{stepClusterClass:(0,r.withCtx)((()=>[(0,r.createVNode)(n,{rows:l.clusterClassOptions,"key-field":"id","name-field":"label","side-label-field":"tag",onClicked:l.clickedType},null,8,["rows","onClicked"])])),stepConfiguration:(0,r.withCtx)((()=>[e.isView?(0,r.createCommentVNode)("",!0):((0,r.openBlock)(),(0,r.createBlock)(i,{key:0,value:a.value,mode:a.mode,namespaced:!1,"name-label":"cluster.name.label","name-placeholder":"cluster.name.placeholder","description-label":"cluster.description.label","description-placeholder":"cluster.description.placeholder",rules:{name:e.fvGetAndReportPathRules("metadata.name")},"onUpdate:value":t[0]||(t[0]=t=>e.$emit("update:value",{k:"metadata",val:t.metadata}))},null,8,["value","mode","rules"])),(0,r.createElementVNode)("div",m,[(0,r.createElementVNode)("div",h,[(0,r.createElementVNode)("h2",null,[(0,r.createVNode)(c,{k:"capi.cluster.version.title"})]),(0,r.createVNode)(d,{value:a.value.spec.topology.version,mode:a.mode,"label-key":"cluster.kubernetesVersion.label",required:"",rules:e.fvGetAndReportPathRules("spec.topology.version"),"onUpdate:value":t[1]||(t[1]=t=>e.$emit("update:value",{k:"spec.topology.version",val:t}))},null,8,["value","mode","rules"])]),(0,r.createElementVNode)("div",f,[(0,r.createElementVNode)("h2",null,[(0,r.createVNode)(c,{k:"capi.cluster.controlPlaneEndpoint.title"})]),(0,r.createVNode)(u,{value:l.controlPlaneEndpoint,"onUpdate:value":[t[2]||(t[2]=e=>l.controlPlaneEndpoint=e),t[3]||(t[3]=t=>e.$emit("update:value",{k:"spec.controlPlaneEndpoint",val:t}))],mode:a.mode,rules:{host:e.fvGetAndReportPathRules("spec.controlPlaneEndpoint.host"),port:e.fvGetAndReportPathRules("spec.controlPlaneEndpoint.port")}},null,8,["value","mode","rules"])])]),(0,r.createElementVNode)("div",b,[(0,r.createElementVNode)("h2",null,[(0,r.createVNode)(c,{k:"capi.cluster.networking.title"})]),(0,r.createVNode)(p,{value:l.clusterNetwork,"onUpdate:value":[t[4]||(t[4]=e=>l.clusterNetwork=e),t[5]||(t[5]=t=>e.$emit("update:value",{k:"spec.clusterNetwork",val:t}))],mode:a.mode,rules:{serviceDomain:e.fvGetAndReportPathRules("spec.clusterNetwork.serviceDomain"),apiServerPort:e.fvGetAndReportPathRules("spec.clusterNetwork.apiServerPort"),pods:e.fvGetAndReportPathRules("spec.clusterNetwork.pods"),services:e.fvGetAndReportPathRules("spec.clusterNetwork.services")}},null,8,["value","mode","rules"])]),(0,r.createElementVNode)("div",k,[(0,r.createElementVNode)("h2",null,[(0,r.createVNode)(c,{k:"capi.cluster.workers.title"}),y]),(0,r.createElementVNode)("div",g,[l.machineDeploymentOptions?((0,r.openBlock)(),(0,r.createElementBlock)("div",C,[(0,r.createVNode)(v,{value:l.machineDeployments,mode:a.mode,title:e.t("capi.cluster.workers.machineDeployments.title"),"default-add-value":s.defaultWorkerAddValue,"class-options":l.machineDeploymentOptions,"initial-empty-row":!0,"onUpdate:value":t[6]||(t[6]=t=>e.$emit("update:value",{k:"spec.topology.workers.machineDeployments",val:t}))},null,8,["value","mode","title","default-add-value","class-options"])])):(0,r.createCommentVNode)("",!0),l.machinePoolOptions?((0,r.openBlock)(),(0,r.createElementBlock)("div",N,[(0,r.createVNode)(v,{value:l.machinePools,mode:a.mode,title:e.t("capi.cluster.workers.machinePools.title"),"default-add-value":s.defaultWorkerAddValue,"class-options":l.machinePoolOptions,"initial-empty-row":!0,"onUpdate:value":t[7]||(t[7]=t=>e.$emit("update:value",{k:"spec.topology.workers.machinePools",val:t}))},null,8,["value","mode","title","default-add-value","class-options"])])):(0,r.createCommentVNode)("",!0)])])])),stepVariables:(0,r.withCtx)((()=>[(0,r.createElementVNode)("h2",null,[(0,r.createVNode)(c,{k:"capi.cluster.variables.title"})]),(0,r.createVNode)(w,{value:a.value.spec.topology.variables,"cluster-class":s.clusterClassObj,onValidationPassed:t[8]||(t[8]=e=>s.variablesReady=e),"onUpdate:value":t[9]||(t[9]=t=>e.$emit("update:value",{k:"spec.topology.variables",val:t}))},null,8,["value","cluster-class"])])),_:1},8,["mode","resource","errors","done-route","apply-hooks","steps","onDone","onFinish","onCancel"])}var V=a(68851),E=a(78531),x=a(25888),S=a(77651);const P={class:"variables"};function B(e,t,a,o,s,l){const n=(0,r.resolveComponent)("Variable");return(0,r.openBlock)(),(0,r.createElementBlock)("div",P,[e.variableDefinitions&&e.variableDefinitions.length?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:0},(0,r.renderList)(e.variableDefinitions,((t,a)=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:`${t.name}`},[(0,r.createVNode)(n,{ref_for:!0,ref:`${t.name}-input`,variable:t,value:e.valueFor(t),"validate-required":!e.machineDeploymentClass&&!e.machinePoolClass,"onUpdate:value":a=>e.updateVariables(a,t),onValidationPassed:e.updateErrors},null,8,["variable","value","validate-required","onUpdate:value","onValidationPassed"]),e.newComponentType(t,a)?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:`${a}-${e.rerenderKey}`,class:"force-newline"})):(0,r.createCommentVNode)("",!0)],64)))),128)):(0,r.createCommentVNode)("",!0)])}var A=a(12784),$=a.n(A),D=a(92043);const R=e=>((0,r.pushScopeId)("data-v-3b0fd8d0"),e=e(),(0,r.popScopeId)(),e),O={class:"input-label"},U={key:0,class:"icon icon-sm icon-info"},q={key:1,class:"icon icon-warning"},T=R((()=>(0,r.createElementVNode)("div",{class:"flexbox-newline"},null,-1)));function L(e,t,a,o,s,l){const n=(0,r.resolveDirective)("clean-tooltip");return e.componentForType?((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,class:(0,r.normalizeClass)({wider:e.listComponent,"align-center":"checkbox-var"===e.componentForType?.name,[`${e.componentForType.name}`]:!0})},[e.componentForType?((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.componentForType.component),{key:0,value:e.value,label:e.variable.name,placeholder:e.schema.example,tooltip:e.schema.description,required:e.variable.required&&e.validateRequired,title:e.variable.name,options:e.variableOptions,rules:e.listComponent?[]:e.validationRules,type:"number"===e.schema.type||"integer"===e.schema.type?"number":"text","onUpdate:value":e.setValue},{title:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",O,[(0,r.createElementVNode)("span",null,[(0,r.createTextVNode)((0,r.toDisplayString)(e.variable.name)+" ",1),e.schema.description?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("i",U,null,512)),[[n,e.schema.description]]):(0,r.createCommentVNode)("",!0),e.isValid?(0,r.createCommentVNode)("",!0):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("i",q,null,512)),[[n,e.validationErrors.join(" ")]])])])])),_:1},40,["value","label","placeholder","tooltip","required","title","options","rules","type","onUpdate:value"])):(0,r.createCommentVNode)("",!0),T],2)):(0,r.createCommentVNode)("",!0)}var _=a(46343),F=a.n(_),I=a(52635),j=a(41432),M=a(56680),z=a(33918),G=a(65359),Z=a(13089),K=(0,r.defineComponent)({name:"CCVariable",emits:["validation-passed","update:value"],props:{variable:{type:Object,required:!0},value:{type:[String,Object,Boolean,Array,Number],default:()=>null},validateRequired:{type:Boolean,default:!0}},watch:{isValid(e){this.$emit("validation-passed",e)}},created(){this.isValid||this.$emit("validation-passed",!1)},computed:{...(0,G.L8)({t:"i18n/t"}),componentForType(){const{type:e}=this.schema;let t;if(this.variableOptions)t={component:z.A,name:"text-var"};else switch(e){case"object":t={component:j.A,name:"keyvalue-var"};break;case"array":t={component:M.A,name:"arraylist-var"};break;case"string":t={component:E.A,name:"text-var"};break;case"integer":t={component:E.A,name:"text-var"};break;case"number":t={component:E.A,name:"text-var"};break;case"boolean":t={component:I.A,name:"checkbox-var"};break;default:break}return t},schema(){return this.variable?.schema?.openAPIV3Schema},variableOptions(){const e=this.schema?.enum;return e&&e.length?e.map((e=>"object"===typeof e?JSON.stringify(e):e)):null},validationRules(){if(this.isDefaultValue)return[];const e=this.t,t=(0,Z.qW)(e,{key:this.variable.name},this.schema),a=this.variable?.required;return a&&this.validateRequired&&t.push((t=>(0,Z.O9)(t)?void 0:e("validation.required",{key:this.variable.name}))),t},isDefaultValue(){const e=this.schema.default;return void 0!==e&&F()(e,this.value)},isValid(){return!this.validationErrors.length},validationErrors(){return this.validationRules.reduce(((e,t)=>{const a=t(this.value);return a&&e.push(a),e}),[])},listComponent(){return"arraylist-var"===this.componentForType?.name||"keyvalue-var"===this.componentForType?.name}},methods:{setValue(e){let t=e;const{type:a}=this.schema;if("object"===a)try{t=JSON.parse(e)}catch{}this.$emit("update:value",t)}}}),W=(a(816),a(47433));const Q=(0,W.A)(K,[["render",L],["__scopeId","data-v-3b0fd8d0"]]);var H=Q,J=(0,r.defineComponent)({name:"ClusterClassVariables",components:{Variable:H},emits:["validation-passed","update:value"],props:{clusterClass:{type:Object,default:()=>{}},value:{type:Array,default:()=>[]},machineDeploymentClass:{type:String,default:null},machinePoolClass:{type:String,default:null}},data(){return{errorCount:0,rerenderKey:(0,D.vx)()}},watch:{errorCount:{handler:$()((function(e){this.$emit("validation-passed",!e)}),5)},variableDefinitions(e,t){this.updateVariableDefaults(e,t),this.$nextTick((()=>{this.rerenderKey=(0,D.vx)()}))}},created(){this.updateVariableDefaults(this.variableDefinitions,[])},computed:{variableDefinitions(){const e=this.clusterClass?.spec?.variables||[];if(!this.machineDeploymentClass&&!this.machinePoolClass)return e;const t=this.machineScopedJsonPatches.reduce(((e,t)=>{const a=t?.valueFrom?.variable;if(!a)return e;const r=a.split(/\.|\[/)[0];return"builtin"!==r&&e.push(r),e}),[]);return e.filter((e=>t.includes(e.name)))},machineScopedJsonPatches(){if(!this.machineDeploymentClass&&!this.machinePoolClass)return[];const e=[],t=this.machineDeploymentClass||this.machinePoolClass,a=this.machineDeploymentClass?"machineDeploymentClass":"machinePoolClass",r=this.clusterClass?.spec?.patches||[];return r.forEach((r=>{const o=r?.definitions||[];o.forEach((r=>{const o=r?.selector?.matchResources?.[a]?.names||[];o.includes(t)&&e.push(...r.jsonPatches)}))})),e}},methods:{valueFor(e){return(this.value.find((t=>t.name===e.name))||{}).value},updateVariables(e,t){const a=[...this.value],r=this.value.findIndex((e=>e.name===t.name));r>=0?a[r].value=e:a.push({value:e,name:t.name}),this.$emit("update:value",a)},updateVariableDefaults(e,t){const a=[...this.value].reduce(((a,r)=>{const o=(e||[]).find((e=>e.name===r.name));if(!o)return a;const s=(t||[]).find((e=>e.name===r.name))?.schema?.openAPIV3Schema?.default;void 0!==s&&r.value===s&&delete r.value;let l=o.schema?.openAPIV3Schema?.default;return"boolean"!==o.schema?.openAPIV3Schema?.type||l||(l=!1),void 0===l||r.value||(r.value=l),a.push(r),a}),[]);e.forEach((e=>{let t=e.schema?.openAPIV3Schema?.default;"boolean"!==e.schema?.openAPIV3Schema?.type||t||(t=!1),void 0===t||a.find((t=>t.name===e.name))||a.push({name:e.name,value:t})})),this.errorCount=0,this.$emit("update:value",a)},updateErrors(e){e?this.errorCount--:this.errorCount++},newComponentType(e,t){const a=this.$refs,r=a[`${e.name}-input`]?.[0]?.$el,o=a[`${this.variableDefinitions[t+1]?.name}-input`]?.[0]?.$el;return!!o&&r?._prevClass!==o._prevClass}}});a(99208);const X=(0,W.A)(J,[["render",B],["__scopeId","data-v-6d8013eb"]]);var Y=X;const ee={key:0,class:"container"},te=["data-testid","onClick"],ae={key:1,class:"m-50 text-center"};function re(e,t,a,o,s,l){const n=(0,r.resolveComponent)("ClusterClassCard"),i=(0,r.resolveDirective)("t");return e.rows.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",ee,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.rows,((t,a)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.get(t,e.keyField),"data-testid":e.componentTestid+"-"+a,onClick:r=>e.select(t,a)},[(0,r.createVNode)(n,{value:t.obj,selected:t.selected},null,8,["value","selected"])],8,te)))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",ae,[(0,r.withDirectives)((0,r.createElementVNode)("h1",null,null,512),[[i,e.noDataKey]])]))}var oe=a(56005),se=a.n(oe);const le={class:"card-wrap"},ne={class:"name"},ie={class:"description"},ce={class:"container"},de={class:"leftcol"},ue={class:"rightcol"};function pe(e,t,a,o,s,l){const n=(0,r.resolveComponent)("ClusterCardField");return(0,r.openBlock)(),(0,r.createElementBlock)("div",{class:(0,r.normalizeClass)(["cluster-card-container",{selected:!!e.selected}]),"data-testid":"cluster-class-card"},[(0,r.createElementVNode)("div",le,[(0,r.createElementVNode)("div",ne,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)("div",ie,[(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(e.description),1)]),(0,r.createElementVNode)("div",ce,[(0,r.createElementVNode)("div",de,[(0,r.createVNode)(n,{value:e.controlPlaneName,name:e.t("capi.clusterClassCard.controlPlaneName")},null,8,["value","name"]),(0,r.createVNode)(n,{value:e.controlPlaneKind,name:e.t("capi.clusterClassCard.controlPlaneKind")},null,8,["value","name"]),(0,r.createVNode)(n,{value:e.controlPlaneNamespace,name:e.t("capi.clusterClassCard.controlPlaneNamespace")},null,8,["value","name"])]),(0,r.createElementVNode)("div",ue,[e.machineDeploymentsCount>0?((0,r.openBlock)(),(0,r.createBlock)(n,{key:0,value:e.machineDeploymentsList,name:e.t("capi.clusterClassCard.machineDeploymentsCount",{count:e.machineDeploymentsCount})},null,8,["value","name"])):(0,r.createCommentVNode)("",!0),e.machinePoolsCount>0?((0,r.openBlock)(),(0,r.createBlock)(n,{key:1,value:e.machinePoolsList,name:e.t("capi.clusterClassCard.machinePoolsCount",{count:e.machinePoolsCount})},null,8,["value","name"])):(0,r.createCommentVNode)("",!0)])])])],2)}const ve={class:"label"},me={class:"text-label"},he={class:"value"};function fe(e,t,a,o,s,l){return(0,r.openBlock)(),(0,r.createElementBlock)("div",ve,[(0,r.createElementVNode)("div",me,[(0,r.renderSlot)(e.$slots,"name",{},(()=>[(0,r.createTextVNode)((0,r.toDisplayString)(a.name),1)]),!0)]),(0,r.createElementVNode)("div",he,[(0,r.renderSlot)(e.$slots,"value",{},(()=>[(0,r.createTextVNode)((0,r.toDisplayString)(a.value),1)]),!0)])])}var be={props:{name:{type:String,required:!0},value:{type:[Number,String,void 0],default:""}}};a(13523);const ke=(0,W.A)(be,[["render",fe],["__scopeId","data-v-7407ec5d"]]);var ye=ke,ge=(0,r.defineComponent)({name:"ClusterClassCard",components:{ClusterCardField:ye},props:{value:{type:Object,required:!0},selected:{type:Boolean,default:!1}},data(){return{cloneData:!0,errors:[]}},computed:{...(0,G.L8)({t:"i18n/t"}),name(){return this.value?.metadata?.name||""},description(){return this.value?.metadata?.annotations?.description||""},controlPlaneName(){return this.value?.spec?.controlPlane?.ref?.name},controlPlaneKind(){return this.value?.spec?.controlPlane?.ref?.kind},controlPlaneNamespace(){return this.value?.spec?.controlPlane?.ref?.namespace},machineDeploymentsCount(){return this.value?.spec?.workers?.machineDeployments?.length},machineDeploymentsList(){return this.value?.spec?.workers?.machineDeployments?.map((e=>e.class)).join(", ")||""},machinePoolsCount(){return this.value?.spec?.workers?.machinePools?.length},machinePoolsList(){return this.value?.spec?.workers?.machinePools?.map((e=>e.class)).join(", ")||""}}});a(52008);const Ce=(0,W.A)(ge,[["render",pe],["__scopeId","data-v-6b5d8548"]]);var Ne=Ce,we=(0,r.defineComponent)({components:{ClusterClassCard:Ne},name:"CardGrid",emits:["clicked"],props:{rows:{type:Array,required:!0},keyField:{type:String,default:"key"},noDataKey:{type:String,default:"sortableTable.noRows"},componentTestid:{type:String,default:"select-card-grid"}},methods:{get:i.Jt,select(e,t){this.resetSelected(),this.rows[t].selected=!0,this.$emit("clicked",e,t)},resetSelected(){this.rows.map((e=>{e.selected=!1}))},capitalize:se()}});a(3566);const Ve=(0,W.A)(we,[["render",re],["__scopeId","data-v-78ececd0"]]);var Ee=Ve;const xe={key:0,class:"clearfix"},Se=["data-testid"],Pe={class:"value"},Be={class:"col mt-20"},Ae={class:"col mt-20"},$e={key:0,class:"remove"},De=["disabled","data-testid","onClick"],Re={key:2,class:"text-muted"},Oe={key:3},Ue={key:4,class:"footer"},qe=["disabled"],Te={key:0,class:"mr-5 icon icon-spinner icon-spin icon-lg"};function Le(e,t,a,o,s,l){const n=(0,r.resolveComponent)("LabeledInput"),i=(0,r.resolveComponent)("LabeledSelect");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[a.title?((0,r.openBlock)(),(0,r.createElementBlock)("div",xe,[(0,r.renderSlot)(e.$slots,"title",{},(()=>[(0,r.createElementVNode)("h3",null,(0,r.toDisplayString)(a.title),1)]))])):(0,r.createCommentVNode)("",!0),s.rows.length?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:1},(0,r.renderList)(s.rows,((t,o)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:o,"data-testid":`array-list-box${o}`,class:"box"},[(0,r.renderSlot)(e.$slots,"columns",{queueUpdate:e.queueUpdate,i:o,rows:s.rows,row:t,mode:a.mode,isView:l.isView},(()=>[(0,r.createElementVNode)("div",Pe,[(0,r.renderSlot)(e.$slots,"value",{row:t,mode:a.mode,isView:l.isView,queueUpdate:e.queueUpdate},(()=>[(0,r.createElementVNode)("div",Be,[(0,r.createVNode)(n,{ref_for:!0,ref:"value",value:t.value.name,"onUpdate:value":e=>t.value.name=e,mode:a.mode,disabled:!1,label:e.t("capi.cluster.workers.name")},null,8,["value","onUpdate:value","mode","label"])]),(0,r.createElementVNode)("div",Ae,[(0,r.createVNode)(i,{value:t.value.class,"onUpdate:value":e=>t.value.class=e,mode:a.mode,options:a.classOptions,"label-key":"capi.cluster.workers.class"},null,8,["value","onUpdate:value","mode","options"])])])),a.removeAllowed?((0,r.openBlock)(),(0,r.createElementBlock)("div",$e,[(0,r.renderSlot)(e.$slots,"remove-button",{remove:()=>l.remove(t,o),i:o,row:t},(()=>[(0,r.createElementVNode)("button",{type:"button",disabled:l.isView,class:"btn role-link","data-testid":`remove-item-${o}`,onClick:e=>l.remove(t,o)},(0,r.toDisplayString)(l.removeLabel),9,De)]))])):(0,r.createCommentVNode)("",!0)])]))],8,Se)))),128)):"view"===a.mode?((0,r.openBlock)(),(0,r.createElementBlock)("div",Re," â€” ")):((0,r.openBlock)(),(0,r.createElementBlock)("div",Oe,[(0,r.renderSlot)(e.$slots,"empty")])),a.addAllowed&&!l.isView?((0,r.openBlock)(),(0,r.createElementBlock)("div",Ue,[a.addAllowed?(0,r.renderSlot)(e.$slots,"add",{key:0,add:l.add},(()=>[(0,r.createElementVNode)("button",{type:"button",class:"btn role-tertiary add",disabled:a.loading,"data-testid":"array-list-button",onClick:t[0]||(t[0]=e=>l.add())},[a.loading?((0,r.openBlock)(),(0,r.createElementBlock)("i",Te)):(0,r.createCommentVNode)("",!0),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(l.addLabel),1)],8,qe)])):(0,r.createCommentVNode)("",!0)])):(0,r.createCommentVNode)("",!0)])}var _e={components:{LabeledSelect:z.A,LabeledInput:E.A},emits:["add","remove","update:value"],props:{value:{type:Array,default:null},mode:{type:String,default:n.G5},title:{type:String,required:!0},classOptions:{type:Array,default:null},addAllowed:{type:Boolean,default:!0},removeAllowed:{type:Boolean,default:!0},defaultAddValue:{type:[String,Number,Object,Array],default:""},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data(){const e=(this.value||[])?.slice(),t=[];for(const a of e)t.push({value:a});if(!t.length){const e=this.defaultAddValue?(0,i.o8)(this.defaultAddValue):"";t.push({value:e})}return{rows:t,lastUpdateWasFromValue:!1}},computed:{isView(){return this.mode===n.nW},removeLabel(){return this.$store.getters["i18n/t"]("generic.remove")},addLabel(){return this.$store.getters["i18n/t"]("generic.add")}},watch:{value:{deep:!0,handler(){this.lastUpdateWasFromValue=!0,this.rows=(this.value||[]).map((e=>({value:e})))}},rows:{deep:!0,handler(){this.lastUpdateWasFromValue||this.queueUpdate(),this.lastUpdateWasFromValue=!1}}},created(){this.queueUpdate=$()(this.update,50)},methods:{add(){this.rows.push({value:(0,i.o8)(this.defaultAddValue)}),this.defaultAddValue&&this.queueUpdate(),this.$nextTick((()=>{const e=this.$refs.value;e&&e.length>0&&e[e.length-1].focus(),this.$emit("add")}))},remove(e,t){this.$emit("remove",{row:e,index:t}),(0,V.Wq)(this.rows,t),this.queueUpdate()},update(){if(this.isView)return;const e=[];for(const t of this.rows){const a=t.value;"undefined"!==typeof a&&e.push(a)}this.$emit("update:value",e)},valUpdate(e,t){t.value.name=e.data}}};const Fe=(0,W.A)(_e,[["render",Le]]);var Ie=Fe;const je={class:"row mb-20"},Me={class:"col span-3"},ze={class:"col span-3"},Ge={class:"row mb-20"},Ze={class:"col span-3"},Ke={class:"col span-3"};function We(e,t,a,o,s,l){const n=(0,r.resolveComponent)("LabeledInput"),i=(0,r.resolveComponent)("ArrayList");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.createElementVNode)("div",je,[(0,r.createElementVNode)("div",Me,[(0,r.createVNode)(n,{value:a.value.apiServerPort,"onUpdate:value":t[0]||(t[0]=e=>a.value.apiServerPort=e),mode:a.mode,disabled:l.clusterIsAlreadyCreated,label:e.t("capi.cluster.networking.apiServerPort"),rules:a.rules.apiServerPort,required:""},null,8,["value","mode","disabled","label","rules"])]),(0,r.createElementVNode)("div",ze,[(0,r.createVNode)(n,{value:a.value.serviceDomain,"onUpdate:value":t[1]||(t[1]=e=>a.value.serviceDomain=e),mode:a.mode,disabled:l.clusterIsAlreadyCreated,label:e.t("capi.cluster.networking.serviceDomain"),rules:a.rules.serviceDomain},null,8,["value","mode","disabled","label","rules"])])]),(0,r.createElementVNode)("div",Ge,[(0,r.createElementVNode)("div",Ze,[(0,r.createVNode)(i,{value:a.value.pods.cidrBlocks,"onUpdate:value":t[2]||(t[2]=e=>a.value.pods.cidrBlocks=e),protip:!1,mode:a.mode,title:e.t("capi.cluster.networking.pods"),rules:a.rules.pods},null,8,["value","mode","title","rules"])]),(0,r.createElementVNode)("div",Ke,[(0,r.createVNode)(i,{value:a.value.services.cidrBlocks,"onUpdate:value":t[3]||(t[3]=e=>a.value.services.cidrBlocks=e),protip:!1,mode:a.mode,title:e.t("capi.cluster.networking.services"),rules:a.rules.services},null,8,["value","mode","title","rules"])])])])}var Qe={components:{LabeledInput:E.A,ArrayList:M.A},props:{value:{type:Object,required:!0},mode:{type:String,required:!0},rules:{default:()=>({serviceDomain:[],apiServerPort:[],pods:[],services:[]}),type:Object}},computed:{...(0,G.L8)({t:"i18n/t"}),clusterIsAlreadyCreated(){return this.mode===n.G5}}};const He=(0,W.A)(Qe,[["render",We]]);var Je=He;const Xe={class:"row mb-20"},Ye={class:"col"},et={class:"col"};function tt(e,t,a,o,s,l){const n=(0,r.resolveComponent)("LabeledInput");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.createElementVNode)("div",Xe,[(0,r.createElementVNode)("div",Ye,[(0,r.createVNode)(n,{value:a.value.host,"onUpdate:value":t[0]||(t[0]=e=>a.value.host=e),mode:a.mode,disabled:l.clusterIsAlreadyCreated,label:e.t("capi.cluster.controlPlaneEndpoint.host"),rules:a.rules.host},null,8,["value","mode","disabled","label","rules"])]),(0,r.createElementVNode)("div",et,[(0,r.createVNode)(n,{value:a.value.port,"onUpdate:value":t[1]||(t[1]=e=>a.value.port=e),mode:a.mode,disabled:l.clusterIsAlreadyCreated,label:e.t("capi.cluster.controlPlaneEndpoint.port"),rules:a.rules.port,type:"number"},null,8,["value","mode","disabled","label","rules"])])])])}var at={name:"ControlPlaneEndpointSection",components:{LabeledInput:E.A},emits:["update:value"],props:{value:{type:Object,required:!0},mode:{type:String,required:!0},rules:{default:()=>({host:[],port:[]}),type:Object}},computed:{...(0,G.L8)({t:"i18n/t"}),clusterIsAlreadyCreated(){return this.mode===n.G5}}};const rt=(0,W.A)(at,[["render",tt]]);var ot=rt;const st={version:"",class:"",workers:{machineDeployments:[],machinePools:[]}},lt={apiServerPort:6443,pods:{cidrBlocks:[]},serviceDomain:"",services:{cidrBlocks:[]}},nt={host:"",port:49152};var it={name:"ClusterConfig",components:{CruResource:u.A,Loading:d.A,NameNsDescription:x.A,LabeledInput:E.A,WorkerItem:Ie,NetworkSection:Je,ControlPlaneEndpointSection:ot,ClusterClassVariables:Y,CardGrid:Ee},mixins:[c.A,S.A],emits:["update:value"],props:{mode:{type:String,required:!0},value:{type:Object,required:!0},preselectedClass:{type:String,required:!1,default:""},clusterClasses:{type:Array,required:!0}},beforeMount(){this.initSpecs(),this.$nextTick((()=>{this.loading=!1}))},data(){const e=this.$store,t=e.getters["i18n/t"],a={name:"stepClusterClass",title:t("capi.cluster.steps.clusterClass.title"),label:t("capi.cluster.steps.clusterClass.label"),subtext:"",descriptionKey:"capi.cluster.steps.clusterClass.description",ready:!1,weight:30},r={name:"stepConfiguration",title:t("capi.cluster.steps.configuration.title"),label:t("capi.cluster.steps.configuration.label"),subtext:"",descriptionKey:"capi.cluster.steps.configuration.description",ready:!1,weight:30},o={name:"stepVariables",title:t("capi.cluster.steps.variables.title"),label:t("capi.cluster.steps.variables.label"),subtext:"",descriptionKey:"capi.cluster.steps.variables.description",ready:!0,weight:30},s=this.preselectedClass?[r,o]:[a,r,o];return{addSteps:s,fvFormRuleSets:[{path:"metadata.name",rules:["required"]},{path:"spec.topology.version",rules:["required","version"]},{path:"spec.controlPlaneEndpoint.host",rules:["host"]},{path:"spec.controlPlaneEndpoint.port",rules:["port"]},{path:"spec.clusterNetwork.serviceDomain",rules:["host"]},{path:"spec.clusterNetwork.apiServerPort",rules:["required","port"]},{path:"spec.clusterNetwork.pods",rules:["cidr"]},{path:"spec.clusterNetwork.services",rules:["cidr"]}],credentialId:"",credential:null,versionInfo:{},defaultWorkerAddValue:{name:"",class:""},variablesReady:!0,clusterClassObj:null,loading:!0}},watch:{clusterClassObj(e){const t=this.addSteps.find((e=>"stepClusterClass"===e.name));t&&(t.ready=!!e)},stepConfigurationRequires(e){const t=this.addSteps.find((e=>"stepConfiguration"===e.name));t.ready=!!e},variablesReady(e){const t=this.addSteps.find((e=>"stepVariables"===e.name));t.ready=!!e}},computed:{fvExtraRules(){return{version:(0,Z.tn)(this.$store.getters["i18n/t"],this.controlPlane),host:(0,Z.l1)(this.$store.getters["i18n/t"]),port:(0,Z.Q3)(this.$store.getters["i18n/t"]),cidr:(0,Z.z0)(this.$store.getters["i18n/t"])}},stepConfigurationRequires(){const e=!!this.value.metadata.name,t=(0,Z.Lw)(this.$store.getters["i18n/t"],this.controlPlane),a=this.value?.spec?.topology?.version&&!!this.value?.spec?.topology?.version.match(t),r=!(0,Z.Q3)(this.$store.getters["i18n/t"])(this.value?.spec?.controlPlaneEndpoint?.port),o=!(0,Z.l1)(this.$store.getters["i18n/t"])(this.value?.spec?.controlPlaneEndpoint?.host),s=this.value?.spec?.topology?.workers?.machineDeployments?.length>0&&!!this.value?.spec?.topology?.workers?.machineDeployments[0]?.name&&!!this.value?.spec?.topology?.workers?.machineDeployments[0]?.class,l=this.value?.spec?.topology?.workers?.machinePools?.length>0&&!!this.value?.spec?.topology?.workers?.machinePools[0]?.name&&!!this.value?.spec?.topology?.workers?.machinePools[0]?.class,n=!this.value?.spec?.clusterNetwork?.pods?.cidrBlocks||(0,Z.Eg)(this.value.spec.clusterNetwork.pods.cidrBlocks),i=!this.value?.spec?.clusterNetwork?.services?.cidrBlocks||(0,Z.Eg)(this.value.spec.clusterNetwork.services.cidrBlocks),c=!!this.value?.spec?.clusterNetwork?.apiServerPort&&!isNaN(this.value?.spec?.clusterNetwork?.apiServerPort)&&n&&i;return e&&a&&o&&r&&c&&(s||l)},clusterNetwork(){return this.value?.spec?.clusterNetwork},controlPlaneEndpoint(){return this.value?.spec?.controlPlaneEndpoint},machineDeployments(){return this.value.spec.topology.workers.machineDeployments},machinePools(){return this.value.spec.topology.workers.machinePools},machineDeploymentOptions(){return this.clusterClassObj?.spec?.workers?.machineDeployments?.map((e=>e.class))},machinePoolOptions(){return this.clusterClassObj?.spec?.workers?.machinePools?.map((e=>e.class))},controlPlane(){return this.clusterClassObj?.spec?.controlPlane?.ref?.name},clusterClassOptions(){const e=[],t=this.clusterClassObj;return this.clusterClasses.forEach((e=>{a(e)})),e;function a(a){const r=a?.id,o={id:r,obj:a,selected:t===a};e.push(o)}}},methods:{set:i.hZ,setClassInfo(e){this.clusterClassObj=this.clusterClasses.find((t=>{const a=unescape(e).split("/");return t.metadata.namespace===a[0]&&t.metadata.name===a[1]}))||null,this.clusterClassObj?(this.setClass(),this.setNamespace()):this.errors.push(this.t("error.clusterClassNotFound"))},setClass(){const e=this.clusterClassObj?.metadata?.name;this.$emit("update:value",{k:"spec.topology.class",val:e})},setNamespace(){const e=this.clusterClassObj?.metadata?.namespace;this.$emit("update:value",{k:"metadata.namespace",val:e})},async saveOverride(){this.errors&&(0,V.IU)(this.errors);try{return await this.value.save(),this.done()}catch(e){this.errors.push(e)}},initSpecs(){const e=this.value;e||(0,i.hZ)(e,"spec",{}),e.spec.topology||(0,i.hZ)(e.spec,"topology",(0,i.o8)(st)),e.spec.clusterNetwork||(0,i.hZ)(e.spec,"clusterNetwork",(0,i.o8)(lt)),e.spec.controlPlaneEndpoint||(0,i.hZ)(e.spec,"controlPlaneEndpoint",(0,i.o8)(nt)),this.$emit("update:value",{k:"spec",val:e.spec}),this.preselectedClass&&this.setClassInfo(this.preselectedClass)},cancelCredential(){this.$refs.cruresource&&this.$refs.cruresource.emitOrRoute()},cancel(){this.$router.push({name:"c-cluster-manager-capi",params:{}})},done(){this.$router.push({name:"c-cluster-manager-capi",params:{}})},clickedType(e){this.clusterClassObj=this.clusterClasses.find((t=>t.id===e.id))||null,this.setClass(),this.setNamespace()}}};a(28379);const ct=(0,W.A)(it,[["render",w],["__scopeId","data-v-18d46140"]]);var dt=ct,ut={name:"CreateCluster",components:{CruResource:u.A,Loading:d.A,ClusterConfig:dt},emits:["update:value"],mixins:[c.A],props:{value:{type:Object,default:null},componentTestid:{type:String,default:"capi-provider-create"},mode:{type:String,required:!0}},beforeMount(){this.value.spec||(0,i.hZ)(this.value,"spec",{}),this.value.id||this.value.metadata||(0,i.hZ)(this.value,"metadata",{}),this.getClusterClasses().then((e=>{this.clusterClasses=e,this.loading=!1})).catch((e=>{this.errors.push(e),this.loading=!1}))},data(){const e=this.$route,t=e.query[n.UA]||null,a=e.query[p.uB.CLASS],r=this.value?.spec?.topology?.class,o=this.value?.metadata?.namespace,s=o&&r?escape(`${o}/${r}`):null,l=a||s||null;return{subType:t,preselectedClass:l,capiProviders:[],clusterClasses:[],loading:!0}},methods:{set:i.hZ,async getClusterClasses(){const e=await this.$store.dispatch("management/findAll",{type:p.qt.CLUSTER_CLASS});return e},cancel(){this.$router.push({name:"c-cluster-manager-capi",params:{}})}}};const pt=(0,W.A)(ut,[["render",l]]);var vt=pt},60510:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ae}});var r=a(9274);const o={class:"mb-20",style:{width:"100%"}},s=(0,r.createElementVNode)("div",null,null,-1);function l(e,t,a,l,n,i){const c=(0,r.resolveComponent)("SelectIconGrid"),d=(0,r.resolveComponent)("ProviderConfig"),u=(0,r.resolveComponent)("CruResource");return(0,r.openBlock)(),(0,r.createBlock)(u,{mode:e.mode,"validation-passed":!0,"selected-subtype":n.subType,resource:a.value,errors:e.errors,subtypes:i.subTypes,"cancel-event":!0,"prevent-enter-submit":!0,class:"create-cluster",onFinish:e.save,onCancel:e.done,onSelectType:i.selectType,onError:t[1]||(t[1]=t=>e.errors=t)},(0,r.createSlots)({subtypes:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",o,[(0,r.createVNode)(c,{rows:i.subTypes,"key-field":"id","name-field":"label","side-label-field":"tag",onClicked:i.clickedType},null,8,["rows","onClicked"])])])),default:(0,r.withCtx)((()=>[n.subType?((0,r.openBlock)(),(0,r.createBlock)(d,{key:0,value:a.value,mode:e.mode,provider:n.subType,"onUpdate:value":t[0]||(t[0]=e=>i.set(a.value,e.k,e.val))},null,8,["value","mode","provider"])):(0,r.createCommentVNode)("",!0)])),_:2},[n.subType?{name:"form-footer",fn:(0,r.withCtx)((()=>[s])),key:"0"}:void 0]),1032,["mode","selected-subtype","resource","errors","subtypes","onFinish","onCancel","onSelectType"])}var n=a(5742),i=a(74920),c=a(1987),d=a(14220),u=a(24850);const p={key:0},v={class:"row mb-20"},m={class:"col span-3"},h={class:"col span-3"},f={class:"col span-3"},b={class:"row mb-40"},k={class:"col span-6"},y={key:1,class:"mb-40"},g={key:2,class:"mb-20"},C={key:3},N={class:"mb-20"},w={key:4},V={key:1,class:"mb-40"},E={class:"mb-20"},x={key:2},S=(0,r.createElementVNode)("div",null,null,-1);function P(e,t,a,o,s,l){const n=(0,r.resolveComponent)("Loading"),i=(0,r.resolveComponent)("NameNsDescription"),c=(0,r.resolveComponent)("LabeledInput"),d=(0,r.resolveComponent)("LabeledSelect"),u=(0,r.resolveComponent)("t"),P=(0,r.resolveComponent)("SelectCredential"),B=(0,r.resolveComponent)("Banner"),A=(0,r.resolveComponent)("Checkbox"),$=(0,r.resolveComponent)("KeyValue"),D=(0,r.resolveComponent)("CruResource");return s.loading?((0,r.openBlock)(),(0,r.createBlock)(n,{key:0})):((0,r.openBlock)(),(0,r.createBlock)(D,{key:1,ref:"providercruresource","can-yaml":!1,mode:a.mode,"validation-passed":e.fvFormIsValid,resource:a.value,errors:e.fvUnreportedValidationErrors,"cancel-event":!0,"done-route":e.doneRoute,"apply-hooks":e.applyHooks,class:"provider","component-testid":"capi-provider-create",onDone:e.done,onFinish:l.saveOverride,onCancel:e.done,onError:t[13]||(t[13]=t=>e.errors=t)},(0,r.createSlots)({default:(0,r.withCtx)((()=>[(0,r.createVNode)(i,{value:a.value,mode:a.mode,namespaced:!0,"namespace-options":s.allNamespaces,"namespace-new-allowed":!0,"name-label":"capi.provider.name.label","name-placeholder":"capi.provider.name.placeholder","description-label":"capi.provider.description.label","description-placeholder":"capi.provider.description.placeholder",rules:{name:e.fvGetAndReportPathRules("metadata.name")},"onUpdate:value":t[0]||(t[0]=t=>e.$emit("update:value",{k:"metadata",val:t.metadata}))},null,8,["value","mode","namespace-options","rules"]),l.isCustom?((0,r.openBlock)(),(0,r.createElementBlock)("div",p,[(0,r.createElementVNode)("div",v,[(0,r.createElementVNode)("div",m,[(0,r.createVNode)(c,{value:a.value.spec.name,mode:a.mode,"label-key":"capi.provider.label","placeholder-key":"capi.provider.placeholder",required:"",rules:e.fvGetAndReportPathRules("spec.name"),"onUpdate:value":t[1]||(t[1]=t=>e.$emit("update:value",{k:"spec.name",val:t}))},null,8,["value","mode","rules"])]),(0,r.createElementVNode)("div",h,[(0,r.createVNode)(d,{value:a.value.spec.type,mode:a.mode,options:l.typeOptions,"label-key":"capi.provider.type.label",disabled:l.isEdit,required:"","onUpdate:value":t[2]||(t[2]=t=>e.$emit("update:value",{k:"spec.type",val:t}))},null,8,["value","mode","options","disabled"])]),(0,r.createElementVNode)("div",f,[(0,r.createVNode)(c,{value:a.value.spec.version,mode:a.mode,"label-key":"capi.provider.version.label","placeholder-key":"capi.provider.version.placeholder",rules:e.fvGetAndReportPathRules("spec.version"),required:"","onUpdate:value":t[3]||(t[3]=t=>e.$emit("update:value",{k:"spec.version",val:t}))},null,8,["value","mode","rules"])])]),(0,r.createElementVNode)("div",b,[(0,r.createElementVNode)("div",k,[(0,r.createVNode)(c,{value:a.value.spec.fetchConfig.url,mode:a.mode,"label-key":"capi.provider.fetchConfigURL.label","placeholder-key":"capi.provider.fetchConfigURL.placeholder",rules:e.fvGetAndReportPathRules("spec.fetchConfig.url"),"onUpdate:value":t[4]||(t[4]=t=>e.$emit("update:value",{k:"spec.fetchConfig.url",val:t}))},null,8,["value","mode","rules"])])])])):(0,r.createCommentVNode)("",!0),s.credentialComponent?((0,r.openBlock)(),(0,r.createElementBlock)("div",y)):(0,r.createCommentVNode)("",!0),l.hasFeatures||l.hasVariables?((0,r.openBlock)(),(0,r.createElementBlock)("h2",g,[(0,r.createVNode)(u,{k:"capi.provider.secret.title"})])):(0,r.createCommentVNode)("",!0),s.credentialComponent?((0,r.openBlock)(),(0,r.createElementBlock)("div",C,[(0,r.createElementVNode)("h3",N,[(0,r.createVNode)(u,{k:"capi.provider.cloudCredential.title"})]),(0,r.createVNode)(P,{value:a.value.spec.credentials.rancherCloudCredentialNamespaceName,"onUpdate:value":[t[5]||(t[5]=e=>a.value.spec.credentials.rancherCloudCredentialNamespaceName=e),t[6]||(t[6]=t=>e.$emit("update:value",{k:"spec.credentials.rancherCloudCredentialNamespaceName",val:t}))],mode:a.mode,provider:s.credentialComponent,cancel:l.cancelCredential,"showing-form":l.showForm,class:"mb-40"},null,8,["value","mode","provider","cancel","showing-form"])])):(0,r.createCommentVNode)("",!0),l.waitingForCredential?(0,r.createCommentVNode)("",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",w,[l.shouldShowBanner?((0,r.openBlock)(),(0,r.createBlock)(B,{key:0,color:"info"},{default:(0,r.withCtx)((()=>[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("capi.provider.banner")),1)])),_:1})):(0,r.createCommentVNode)("",!0),l.hasFeatures?((0,r.openBlock)(),(0,r.createElementBlock)("div",V,[(0,r.createElementVNode)("h3",E,[(0,r.createVNode)(u,{k:"capi.provider.features.title"})]),(0,r.createVNode)(A,{value:a.value.spec.features.clusterResourceSet,mode:a.mode,label:e.t("capi.provider.features.clusterResourceSet"),"onUpdate:value":t[7]||(t[7]=t=>e.$emit("update:value",{k:"spec.features.clusterResourceSet",val:t}))},null,8,["value","mode","label"]),(0,r.createVNode)(A,{value:a.value.spec.features.clusterTopology,"onUpdate:value":[t[8]||(t[8]=e=>a.value.spec.features.clusterTopology=e),t[9]||(t[9]=t=>e.$emit("update:value",{k:"spec.features.clusterTopology",val:t}))],mode:a.mode,label:e.t("capi.provider.features.clusterTopology")},null,8,["value","mode","label"]),(0,r.createVNode)(A,{value:a.value.spec.features.machinePool,"onUpdate:value":[t[10]||(t[10]=e=>a.value.spec.features.machinePool=e),t[11]||(t[11]=t=>e.$emit("update:value",{k:"spec.features.machinePool",val:t}))],mode:a.mode,label:e.t("capi.provider.features.machinePool")},null,8,["value","mode","label"])])):(0,r.createCommentVNode)("",!0),l.hasVariables?((0,r.openBlock)(),(0,r.createElementBlock)("div",x,[(0,r.createElementVNode)("h3",null,[(0,r.createVNode)(u,{k:"capi.provider.variables.title"})]),(0,r.createVNode)($,{value:a.value.spec.variables,"add-label":e.t("capi.provider.variables.add"),mode:a.mode,"value-can-be-empty":!0,"handle-base64":!1,"value-trim":!1,"add-allowed":!0,"read-allowed":!0,"parse-lines-from-file":!0,"onUpdate:value":t[12]||(t[12]=t=>e.$emit("update:value",{k:"spec.variables",val:t}))},null,8,["value","add-label","mode"])])):(0,r.createCommentVNode)("",!0)]))])),_:2},[l.waitingForCredential?{name:"form-footer",fn:(0,r.withCtx)((()=>[S])),key:"0"}:void 0]),1032,["mode","validation-passed","resource","errors","done-route","apply-hooks","onDone","onFinish","onCancel"]))}var B=a(65359),A=a(68851),$=a(35664),D=a(29822),R=a(96046),O=a(77651),U=a(52635),q=a(92043),T=a(76978),L=a(25888),_=a(41432),F=a(78531),I=a(33918),j=a(19151),M=a(88339),z=a(13089);const G={clusterResourceSet:!0,clusterTopology:!0,machinePool:!0},Z={},K={name:"",type:"infrastructure",configSecret:{name:""},credentials:{rancherCloudCredentialNamespaceName:""}},W={name:"",type:"infrastructure",configSecret:{name:""},credentials:{rancherCloudCredentialNamespaceName:""},fetchConfig:{url:""},version:""},Q=["infrastructure","bootstrap","controlPlane","addon","ipam","runtimeextension","core"];var H={name:"ProviderConfig",components:{CruResource:i.A,Loading:D.A,NameNsDescription:L.A,SelectCredential:R.A,Checkbox:U.A,KeyValue:_.A,LabeledInput:F.A,LabeledSelect:I.A,Banner:j.A},mixins:[n.A,O.A],emits:["update:value"],props:{mode:{type:String,required:!0},value:{type:Object,required:!0},provider:{type:String,required:!0}},beforeMount(){this.getDependencies().then((e=>{this.allNamespaces=e.namespaces||[],this.coreProviderSecret=e.coreProviderSecret||{},this.initSpecs(),this.loading=!1})).catch((e=>{this.errors.push(e),this.initSpecs(),this.loading=!1}))},data(){const e=u.MA.find((e=>e.id===this.provider))||{disabled:!1,id:"0"};return{loading:!0,fvFormRuleSets:[{path:"metadata.name",rules:["name"]},{path:"spec.name",rules:["required"]},{path:"spec.version",rules:["version"]},{path:"spec.fetchConfig.url",rules:["url"]}],allNamespaces:[],credentialComponent:e?.credential}},computed:{...(0,B.L8)(["namespaces"]),fvExtraRules(){return{name:(0,z.Vd)(this.$store.getters["i18n/t"]),version:(0,z.wU)(this.$store.getters["i18n/t"],this.isCustom),url:(0,z.IF)(this.$store.getters["i18n/t"])}},typeOptions(){return Q.map((e=>({label:this.t(`capi.provider.type.${e}.label`),value:e})))},showForm(){return!!this.value.spec.credentials.rancherCloudCredentialNamespaceName||!this.credentialComponent},isEdit(){return this.mode===d.G5},hasFeatures(){return!!this.value?.spec?.features},hasVariables(){return!!this.value?.spec?.variables},isCustom(){return"custom"===this.provider},shouldShowBanner(){return this.isEdit&&(this.hasFeatures||this.hasVariables)},waitingForCredential(){return this.credentialComponent&&!this.value.spec.credentials.rancherCloudCredentialNamespaceName}},methods:{initSpecs(){if(!this.value.spec){const e=this.getSpecFromCoreSecret();"custom"!==this.provider?((0,T.hZ)(this.value,"spec",{...(0,T.o8)(K),...e}),(0,T.hZ)(this.value.spec,"name",this.provider)):(0,T.hZ)(this.value,"spec",{...(0,T.o8)(W),...e})}this.value.spec.configSecret.name||(0,T.hZ)(this.value.spec.configSecret,"name",this.generateName(this.provider))},getSpecFromCoreSecret(){const e=this.coreProviderSecret?.data;if(e){const t=["EXP_CLUSTER_RESOURCE_SET","CLUSTER_TOPOLOGY","EXP_MACHINE_POOL"],a=(0,T.o8)(e);return t.forEach((e=>{delete a[e]})),{features:{clusterResourceSet:"dHJ1ZQ=="===e.EXP_CLUSTER_RESOURCE_SET,clusterTopology:"dHJ1ZQ=="===e.CLUSTER_TOPOLOGY,machinePool:"dHJ1ZQ=="===e.EXP_MACHINE_POOL},variables:a}}return{features:(0,T.o8)(G),variables:(0,T.o8)(Z)}},generateName(e){return e?`${e}-credentials-${(0,q.vx)(5).toLowerCase()}`:void 0},async getDependencies(){const e=this.$store.getters["currentStore"]($.CU),{$store:t}=this,a={namespaces:t.dispatch(`${e}/findAll`,{type:$.CU}),coreProviderSecret:t.dispatch("management/find",{type:$.bB,id:`${u.Ch}/${u.s7}`,opt:{watch:!1,force:!0}})};return await(0,M.kR)(a)},async saveOverride(e){this.errors&&(0,A.IU)(this.errors),this.credentialComponent||this.value.spec?.credentials?.rancherCloudCredentialNamespaceName||(this.value.spec.credentials=null);try{await this.save(e,null)}catch(t){this.errors.push(t),e(!1)}},cancelCredential(){this.$refs.providercruresource&&this.$refs.providercruresource.emitOrRoute()}}},J=a(47433);const X=(0,J.A)(H,[["render",P]]);var Y=X,ee={name:"CreateProvider",components:{CruResource:i.A,SelectIconGrid:c.A,ProviderConfig:Y},mixins:[n.A],emits:["set-subtype","update:value"],props:{value:{type:Object,default:null},componentTestid:{type:String,default:"capi-provider-create"}},beforeMount(){this.value?.spec?.name&&this.selectType(this.value.spec.name)},data(){const e=this.$route,t=e?.query[d.UA]||null;return{subType:t}},computed:{subTypes(){const e=[],t=this.$store.getters;return u.MA?.forEach((e=>{r(e.id,e.disabled)})),e;function r(r,o=!1){const s=t["i18n/withFallback"](`cluster.provider."${r}"`,null,r),l=t["i18n/withFallback"](`cluster.providerDescription."${r}"`,null,"");let n;try{n=a(53588)(`./${r}.svg`)}catch(c){try{n=a(36283)(`./${r}.svg`)}catch(c){n=a(76251)}}const i={id:r,label:s,description:l,icon:n,disabled:o};e.push(i)}}},methods:{set:T.hZ,clickedType(e){const t=e.id;this.$router?.applyQuery({[d.UA]:t}),this.selectType(t)},selectType(e){this.subType=e,this.$emit("set-subtype",this.$store.getters["i18n/withFallback"](`cluster.provider."${e}"`,null,e))}}};a(69142);const te=(0,J.A)(ee,[["render",l]]);var ae=te},816:function(e,t,a){var r=a(64336);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("ae690ffc",r,!0,{sourceMap:!1,shadowMode:!1})},99208:function(e,t,a){var r=a(83880);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("0db6e834",r,!0,{sourceMap:!1,shadowMode:!1})},3566:function(e,t,a){var r=a(63118);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("3cf8d8ca",r,!0,{sourceMap:!1,shadowMode:!1})},13523:function(e,t,a){var r=a(94579);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("0638f1ab",r,!0,{sourceMap:!1,shadowMode:!1})},52008:function(e,t,a){var r=a(7560);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("c273d0a0",r,!0,{sourceMap:!1,shadowMode:!1})},28379:function(e,t,a){var r=a(93275);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("e587d5da",r,!0,{sourceMap:!1,shadowMode:!1})},69142:function(e,t,a){var r=a(48214);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("f5487df0",r,!0,{sourceMap:!1,shadowMode:!1})},53588:function(e,t,a){var r={"./aliyun-black.svg":87526,"./aliyun.svg":17180,"./aliyunecs-black.svg":75685,"./aliyunecs.svg":38683,"./amazonec2-black.svg":52212,"./amazonec2.svg":16598,"./amazoneks-black.svg":43881,"./amazoneks.svg":90287,"./aws.svg":59835,"./azure-black.svg":80895,"./azure.svg":60961,"./azuread-black.svg":81392,"./azuread.svg":45634,"./azureaks-black.svg":35894,"./azureaks.svg":40268,"./baidu-black.svg":71351,"./baidu.svg":47113,"./cloudca-black.svg":50309,"./cloudca.svg":23131,"./cloudscale-black.svg":51773,"./cloudscale.svg":86531,"./custom.svg":29181,"./digitalocean-black.svg":65988,"./digitalocean.svg":19110,"./equinix-black.svg":66335,"./equinix.svg":60705,"./exoscale.svg":12896,"./gcp.svg":2054,"./gke-black.svg":3405,"./gke.svg":61939,"./google.svg":32561,"./googlegke-black.svg":73562,"./googlegke.svg":97712,"./harvester.svg":53938,"./huaweicce-black.svg":91128,"./huaweicce.svg":40634,"./import.svg":28499,"./k3s-black.svg":35671,"./k3s.svg":85545,"./kubernetes-black.svg":27442,"./kubernetes.svg":9144,"./linode.svg":75553,"./linodelke-black.svg":96441,"./linodelke.svg":3199,"./local-cluster.svg":47600,"./minikube-black.svg":18152,"./minikube.svg":92746,"./nutanix.svg":70079,"./oci-black.svg":40097,"./oci.svg":46487,"./openstack-black.svg":57990,"./openstack.svg":53116,"./oracle.svg":88594,"./oracleoke-black.svg":56347,"./oracleoke.svg":9053,"./otc-black.svg":67294,"./otc.svg":69348,"./otccce.svg":24079,"./outscale.svg":72886,"./ovhcloudmks.svg":49619,"./ovhcloudpubliccloud.svg":54474,"./packet-black.svg":90742,"./packet.svg":48428,"./pinganyunecs-black.svg":49880,"./pinganyunecs.svg":58490,"./pnap-black.svg":59931,"./pnap.svg":31549,"./rackspace-black.svg":41511,"./rackspace.svg":65785,"./rke.svg":38102,"./rke2.svg":49560,"./softlayer.svg":61883,"./tencenttke-black.svg":70963,"./tencenttke.svg":77701,"./vmwarevsphere-black.svg":26791,"./vmwarevsphere.svg":5337};function o(e){var t=s(e);return a(t)}function s(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=s,e.exports=o,o.id=53588},36283:function(e,t,a){var r={"./docker.svg":17743,"./vsphere-black.svg":49038,"./vsphere.svg":37652};function o(e){var t=s(e);return a(t)}function s(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=s,e.exports=o,o.id=36283},17743:function(e,t,a){"use strict";e.exports=a.p+"img/docker.921780fa.svg"},49038:function(e,t,a){"use strict";e.exports=a.p+"img/vsphere-black.454d68ed.svg"},37652:function(e,t,a){"use strict";e.exports=a.p+"img/vsphere.94d59db3.svg"}}]);
//# sourceMappingURL=capi-0.8.1.umd.min.edit.js.map