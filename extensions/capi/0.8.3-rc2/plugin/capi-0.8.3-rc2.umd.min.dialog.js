(("undefined"!==typeof self?self:this)["webpackChunkcapi_0_8_3_rc2"]=("undefined"!==typeof self?self:this)["webpackChunkcapi_0_8_3_rc2"]||[]).push([[907],{18889:function(e,t,a){"use strict";a.r(t);var s=a(40429),o=a.n(s),r=a(1214),l=a.n(r),n=l()(o());n.push([e.id,".manual-refresh i[data-v-21c97bb9]{margin:0 0 0 8px!important;font-size:1rem!important}",""]),t["default"]=n},11657:function(e,t,a){"use strict";a.r(t);var s=a(40429),o=a.n(s),r=a(1214),l=a.n(r),n=l()(o());n.push([e.id,".fleet-status[data-v-4fd131e6]{display:flex;width:100%;border:1px solid var(--border);border-radius:10px}.header[data-v-4fd131e6]{display:flex;margin-bottom:15px;justify-content:space-between}.progress-container[data-v-4fd131e6]{width:100%;padding:15px}.count[data-v-4fd131e6]{padding:15px;background-color:var(--tabbed-container-bg);border-radius:10px 0 0 10px;display:flex;align-items:center;min-width:60px;justify-content:center;font-size:21px}.progress[data-v-4fd131e6]{display:block;border-radius:90px;background-color:var(--progress-bg);height:10px;width:100%}.progress .piece[data-v-4fd131e6]{display:inline-block;height:10px;border-radius:0;border-right:1px solid var(--progress-divider);vertical-align:top}.progress .piece[data-v-4fd131e6]:first-child{border-top-left-radius:90px;border-bottom-left-radius:90px}.progress .piece[data-v-4fd131e6]:last-child{border-top-right-radius:90px;border-bottom-right-radius:90px;border-right:0}.piece.bg-success[data-v-4fd131e6]:only-child{opacity:.5}.meta-title[data-v-4fd131e6]{display:flex;align-items:center}.meta-title[data-v-4fd131e6]:hover{cursor:pointer;color:var(--link)}.meta-title .icon[data-v-4fd131e6]{margin:4px 0 0 5px;opacity:.3}.resources-dropdown li[data-v-4fd131e6]{display:flex;justify-content:space-between;margin:10px 5px}.resources-dropdown .list-count[data-v-4fd131e6]{margin-left:30px}",""]),t["default"]=n},58887:function(e,t,a){"use strict";a.r(t);var s=a(40429),o=a.n(s),r=a(1214),l=a.n(r),n=l()(o());n.push([e.id,".flexwrap .fleet-status[data-v-d152c236]{max-width:50%;margin-right:15px}.flexwrap .fleet-status[data-v-d152c236]:last-child{margin:0}.countbox[data-v-d152c236]{min-width:150px;width:12.5%;margin-bottom:10px}",""]),t["default"]=n},42121:function(e,t,a){"use strict";a.r(t);var s=a(40429),o=a.n(s),r=a(1214),l=a.n(r),n=l()(o());n.push([e.id,".dialog-container[data-v-33874c1f]{padding:20px}.footer-buttons[data-v-33874c1f]{display:flex;justify-content:flex-end;align-items:center}.footer-buttons[data-v-33874c1f]>*{margin-left:10px}",""]),t["default"]=n},40484:function(e,t,a){"use strict";a.d(t,{A:function(){return y}});var s=a(9274);const o=["name","type","disabled","aria-disabled","tab-index","data-testid"],r=["alt"],l={key:2,"data-testid":"async-btn-display-label"};function n(e,t,a,n,i,c){const d=(0,s.resolveDirective)("clean-tooltip"),p=(0,s.resolveDirective)("clean-html");return(0,s.openBlock)(),(0,s.createElementBlock)("button",{ref:"btn",role:"button",class:(0,s.normalizeClass)(e.classes),name:e.name,type:e.type,disabled:e.disabled,"aria-disabled":e.appearsDisabled,"tab-index":e.tabIndex,"data-testid":e.componentTestid+"-async-button",onClick:t[0]||(t[0]=(...t)=>e.clicked&&e.clicked(...t))},[e.isManualRefresh?((0,s.openBlock)(),(0,s.createElementBlock)("span",{key:0,class:(0,s.normalizeClass)({"mr-10":e.displayIcon&&"sm"!==e.size,"mr-5":e.displayIcon&&"sm"===e.size})},(0,s.toDisplayString)(e.t("action.refresh")),3)):(0,s.createCommentVNode)("",!0),e.displayIcon?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("i",{key:1,class:(0,s.normalizeClass)({icon:!0,"icon-lg":!0,[e.displayIcon]:!0,"mr-0":e.isManualRefresh}),alt:e.t("asyncButton.alt.iconAlt")},null,10,r)),[[d,e.tooltip]]):(0,s.createCommentVNode)("",!0),"text"===e.labelAs&&e.displayLabel?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("span",l,null,512)),[[d,e.tooltip],[p,e.displayLabel]]):(0,s.createCommentVNode)("",!0)],10,o)}var i={memberOfObject:(e,t)=>Object.entries(e||{}).find((([e])=>e===t)),memberOfComponent:(e,t)=>e[t]};const c={ACTION:"action",WAITING:"waiting",SUCCESS:"success",ERROR:"error"},d="text",p="tooltip",u="btn-disabled",m={timer:void 0};var h=(0,s.defineComponent)({props:{mode:{type:String,default:"edit"},delay:{type:Number,default:5e3},name:{type:String,default:null},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"},tabIndex:{type:Number,default:null},actionColor:{type:String,default:"role-primary"},waitingColor:{type:String,default:"bg-primary"},successColor:{type:String,default:"bg-success"},errorColor:{type:String,default:"bg-error"},actionLabel:{type:String,default:null},waitingLabel:{type:String,default:null},successLabel:{type:String,default:null},errorLabel:{type:String,default:null},icon:{type:String,default:null},labelAs:{type:String,default:d},size:{type:String,default:""},currentPhase:{type:String,default:c.ACTION},componentTestid:{type:String,default:"action-button"},manual:{type:Boolean,default:!1}},setup(){const e=(0,s.inject)("timer",m.timer);return{timer:e}},emits:["click"],data(){return{phase:this.currentPhase}},watch:{currentPhase(e){this.phase=e}},computed:{classes(){const e=`${this.phase}Color`,t=i.memberOfComponent(this,e),a={btn:!0,[t]:!0};return this.size&&(a[`btn-${this.size}`]=!0),this.phase===c.WAITING&&(a[u]=!0),this.phase===c.ACTION&&(a["ready-for-action"]=!0),a},appearsDisabled(){return this.disabled||this.phase===c.WAITING},displayIcon(){const e=this.$store.getters["i18n/exists"],t=this.$store.getters["i18n/t"],a=`asyncButton.${this.mode}.${this.phase}Icon`,s=`asyncButton.default.${this.phase}Icon`;let o="";return this.icon?o=this.icon:e(a)?o=`icon-${t(a)}`:e(s)&&(o=`icon-${t(s)}`),this.isSpinning&&(o||(o="icon-spinner"),o+=" icon-spin"),o},displayLabel(){const e=i.memberOfComponent(this,`${this.phase}Label`),t=this.$store.getters["i18n/exists"],a=this.$store.getters["i18n/t"],s=`asyncButton.${this.mode}.${this.phase}`,o=`asyncButton.default.${this.phase}`;return e||(t(s)?a(s):t(o)?a(o):"")},isSpinning(){return this.phase===c.WAITING},isManualRefresh(){return"manual-refresh"===this.mode},tooltip(){return this.labelAs===p?{content:this.displayLabel,hideOnTargetClick:!1}:null}},beforeUnmount(){this.timer&&clearTimeout(this.timer)},methods:{clicked(){if(this.appearsDisabled)return;this.timer&&clearTimeout(this.timer),this.manual||(this.phase=c.WAITING);const e=e=>{this.done(e)};this.$emit("click",e)},done(e){"cancelled"===e?this.phase=c.ACTION:(this.phase=e?c.SUCCESS:c.ERROR,this.timer=setTimeout((()=>{this.timerDone()}),this.delay))},timerDone(){this.phase!==c.SUCCESS&&this.phase!==c.ERROR||(this.phase=c.ACTION)},focus(){this.$refs.btn.focus()}}}),v=(a(11369),a(47433));const f=(0,v.A)(h,[["render",n],["__scopeId","data-v-21c97bb9"]]);var y=f},86963:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return J}});var s=a(9274);const o={class:"dialog-container"},r={key:0,class:"text-label mb-20"},l={key:1,class:"text-label mb-20"},n={key:2},i={key:3,class:"row"},c={class:"col span-12"},d={class:"footer-buttons mt-20"};function p(e,t,a,p,u,m){const h=(0,s.resolveComponent)("t"),v=(0,s.resolveComponent)("Checkbox"),f=(0,s.resolveComponent)("FleetSummary"),y=(0,s.resolveComponent)("AsyncButton");return(0,s.openBlock)(),(0,s.createElementBlock)("div",o,[(0,s.createElementVNode)("h2",null,(0,s.toDisplayString)(e.t("capi.exampleClasses.addExamples")),1),u.gitRepo?.id?((0,s.openBlock)(),(0,s.createElementBlock)("div",l,[(0,s.createVNode)(h,{k:"capi.exampleClasses.done"})])):((0,s.openBlock)(),(0,s.createElementBlock)("div",r,[(0,s.createVNode)(h,{raw:"",k:"capi.exampleClasses.description"})])),u.gitRepo&&!u.gitRepo.id?((0,s.openBlock)(),(0,s.createElementBlock)("div",n,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(u.repoOptions,((e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:e},[(0,s.createVNode)(v,{value:m.paths.includes(e),label:t,"onUpdate:value":t=>t?m.addPath(e):m.removePath(e)},null,8,["value","label","onUpdate:value"])])))),128))])):(0,s.createCommentVNode)("",!0),u.gitRepo.id?((0,s.openBlock)(),(0,s.createElementBlock)("div",i,[(0,s.createElementVNode)("div",c,[u.allBundles&&u.allBundles.length?((0,s.openBlock)(),(0,s.createBlock)(f,{key:0,bundles:u.allBundles,value:u.gitRepo},null,8,["bundles","value"])):(0,s.createCommentVNode)("",!0)])])):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",d,[u.gitRepo.id?((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:1},[(0,s.createElementVNode)("a",{href:"#",onClick:t[1]||(t[1]=(...e)=>m.goToDetail&&m.goToDetail(...e))},(0,s.toDisplayString)(e.t("capi.exampleClasses.viewDetails")),1),(0,s.createElementVNode)("button",{class:"btn role-primary",type:"button",onClick:t[2]||(t[2]=t=>e.$emit("close"))},(0,s.toDisplayString)(e.t("capi.exampleClasses.continue")),1)],64)):((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:0},[(0,s.createElementVNode)("button",{class:"btn role-secondary",type:"button",onClick:t[0]||(t[0]=t=>e.$emit("close"))},(0,s.toDisplayString)(e.t("generic.cancel")),1),(0,s.createVNode)(y,{class:"btn role-primary",type:"button",mode:"saveGitRepo",disabled:!m.paths.length,onClick:m.saveGitRepo},null,8,["disabled","onClick"])],64))])])}var u=a(35664),m=a(91578),h=a(40484),v=(a(50667),a(88339));a(37327),a(44179),a(68851),a(4364);const f=(e,t)=>{const a={};for(const[s,o]of Object.entries(e)){const e=t.getters[`${o.inStoreType}/schemaFor`](o.type),r=o.schemaValidator?o.schemaValidator(e):!!e;if(r){const e=t.dispatch(`${o.inStoreType}/findAll`,{type:o.type,opt:o.opt});o.skipWait||(a[s]=e)}}return(0,v.kR)(a)};const y={class:"row flexwrap"};function g(e,t,a,o,r,l){const n=(0,s.resolveComponent)("FleetStatus");return(0,s.openBlock)(),(0,s.createElementBlock)("div",y,[l.bundleCounts.length?((0,s.openBlock)(),(0,s.createBlock)(n,{key:0,title:"Bundles",values:l.bundleCounts,"value-key":"count","data-testid":"gitrepo-bundle-summary"},null,8,["values"])):(0,s.createCommentVNode)("",!0),(0,s.createVNode)(n,{title:"Resources",values:l.resourceCounts,"value-key":"count","data-testid":"gitrepo-deployment-summary"},null,8,["values"])])}var b=a(27105);const k={class:"fleet-status"},x={class:"count"},C={class:"progress-container"},N={class:"header"},w={class:"title"},E={class:"meta-title"},B={class:"resources-status-list"},S={class:"list-count"},R=["primary-color-var"];function A(e,t,a,o,r,l){const n=(0,s.resolveComponent)("v-dropdown"),i=(0,s.resolveDirective)("trim-whitespace");return(0,s.openBlock)(),(0,s.createElementBlock)("div",k,[(0,s.createElementVNode)("div",x,(0,s.toDisplayString)(l.meta.total),1),(0,s.createElementVNode)("div",C,[(0,s.createElementVNode)("div",N,[(0,s.createElementVNode)("div",w,(0,s.toDisplayString)(a.title),1),(0,s.createElementVNode)("div",{class:"resources-dropdown",tabindex:"0",onBlur:t[1]||(t[1]=e=>l.showMenu(!1)),onClick:t[2]||(t[2]=e=>l.showMenu(!0)),onFocusCapture:t[3]||(t[3]=e=>l.showMenu(!0))},[(0,s.createVNode)(n,{ref:"popover",placement:"bottom",offset:"-10",triggers:[],delay:{show:0,hide:0},flip:!1,container:!1,"popper-class":"fleet-summary-tooltip"},{popper:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",B,[(0,s.createElementVNode)("ul",{class:"list-unstyled dropdown",onClick:t[0]||(t[0]=(0,s.withModifiers)((e=>l.showMenu(!1)),["stop"]))},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.values,((e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("li",{key:t},[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(e.label),1),(0,s.createElementVNode)("span",S,(0,s.toDisplayString)(e.count),1)])))),128))])])])),default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",E,[(0,s.createTextVNode)((0,s.toDisplayString)(l.meta.readyCount)+" / "+(0,s.toDisplayString)(l.meta.total)+" "+(0,s.toDisplayString)(a.title)+" ready ",1),t[4]||(t[4]=(0,s.createElementVNode)("i",{class:"icon toggle icon-chevron-down"},null,-1))])])),_:1},512)],32)]),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{class:(0,s.normalizeClass)({progress:!0,multi:l.pieces.length>1})},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(l.pieces,((e,t)=>(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t,"primary-color-var":e.color,class:(0,s.normalizeClass)({piece:!0,[e.color]:!0}),style:(0,s.normalizeStyle)(e.style)},null,14,R)),[[i]]))),128))],2)),[[i]])])])}var D=a(74302),I=a(76978),$={name:"FleetStatus",props:{values:{type:Array,required:!0},colorKey:{type:String,default:"color"},labelKey:{type:String,default:"label"},valueKey:{type:String,default:"value"},min:{type:Number,default:0},max:{type:Number,default:null},minPercent:{type:Number,default:5},showZeros:{type:Boolean,default:!1},title:{type:String,default:"Resources"}},computed:{meta(){return{total:this.values.map((e=>e.value)).reduce(((e,t)=>e+t),0),readyCount:this.values.filter((e=>e.status===b.jv.SUCCESS||e.status===b.jv.READY)).map((e=>e.value)).reduce(((e,t)=>e+t),0)}},pieces(){let e=[...this.values].reduce(((e,t)=>{const a=(0,I.Jt)(t,this.colorKey),s=(0,I.Jt)(t,this.labelKey),o=(0,I.Jt)(t,this.valueKey);return 0!==t[this.valueKey]||this.showZeros?(e.push({color:a,label:s,value:o,sort:(0,b.gs)(a)}),e):e}),[]);const t=this.minPercent||0,a=this.min||0;let s=this.max,o=0;return this.max||(s=100,e.length&&(s=e.map((e=>e.value)).reduce(((e,t)=>e+t)))),e=this.values.map((e=>{if(0===e.value)return e.percent=0,e;const r=Math.max(t,j(e.value,a,s));return e.percent=r,o+=r,e})),o>100&&((0,D.Ul)(e,"percent",!0)[0].percent-=o-100),e=this.values.map((e=>(e.style=`width: ${e.percent}%; background: var(--${e.color})`,e))),[...e].filter((e=>e.percent))}},methods:{showMenu(e){this.$refs.popover&&(e?this.$refs.popover.show():this.$refs.popover.hide())}}};function j(e,t,a){e=Math.max(t,Math.min(a,e));let s=e/(a-t)*100;return s=Math.floor(100*s)/100,s}a(69577);var O=a(47433);const V=(0,O.A)($,[["render",A],["__scopeId","data-v-4fd131e6"]]);var _=V;const T=(e,t)=>[b.jv.READY,b.jv.NOT_READY,b.jv.WAIT_APPLIED,b.jv.MODIFIED,b.jv.MISSING,b.jv.ORPHANED,b.jv.UNKNOWN].reduce(((a,s)=>(a[s]={count:0,color:b.xj[s].color,label:e(`${t}.${s}`,null,b.xj[s].label),status:s},a)),{}),M=(e,t)=>[b.jv.READY,b.jv.INFO,b.jv.WARNING,b.jv.NOT_READY,b.jv.ERROR,b.jv.ERR_APPLIED,b.jv.WAIT_APPLIED,b.jv.UNKNOWN].reduce(((a,s)=>(a[s]={count:0,color:b.xj[s].color,label:e(`${t}.${s}`,null,b.xj[s].label),status:s},a)),{});var L={name:"FleetSummary",components:{FleetStatus:_},props:{bundles:{type:Array,default:()=>[]},value:{type:Object,required:!0},stateKey:{type:String,default:"fleet.fleetSummary.state"}},computed:{repoName(){return this.value.metadata.name},repoNamespace(){return this.value.metadata.namespace},bundleCounts(){const e=this.bundles.filter((e=>e.namespace===this.repoNamespace&&e.repoName===this.repoName));if(!e.length)return[];const t={...M(this.$store.getters["i18n/withFallback"],this.stateKey)};return e.forEach((({status:e,metadata:a})=>{if(!e)return void(t[b.jv.UNKNOWN].count+=1);const s=e?.summary?.ready>0&&e?.summary.desiredReady===e?.summary?.ready;if(s)return void(t.ready.count+=1);const o=a.state?.name?.toLowerCase();if(o&&t[o])return void(t[o].count+=1);const{conditions:r}=e,l=r.find((({transitioning:e,message:t})=>e&&!t.includes(b.jv.ERROR)&&!t.toLowerCase().includes(b.jv.ERR_APPLIED)));if(l)return void(t.notready.count+=1);const n=r.find((({error:e,message:t})=>!!e&&t.toLowerCase().includes(b.jv.ERR_APPLIED)));if(n)return void(t[b.jv.ERR_APPLIED].count+=1);const i=r.find((({error:e,message:t})=>!!e&&t.toLowerCase().includes(b.jv.ERROR)));t[i]?t[i].count+=1:t.unknown.count+=1})),Object.values(t).map((e=>(e.value=e.count,e)))},resourceCounts(){const e={...T(this.$store.getters["i18n/withFallback"],this.stateKey)},t=this.value.allResourceStatuses;return Object.entries(t.states).filter((([e,t])=>t>0)).forEach((([t,a])=>{const s=t?.toLowerCase();e[s]?e[s].count+=a:e.unknown.count+=a})),Object.values(e).map((e=>(e.value=e.count,e)))}}};a(58631);const P=(0,O.A)(L,[["render",g],["__scopeId","data-v-d152c236"]]);var F=P,z=a(65359);const U="turtles-clusterclasses",K="https://github.com/rancher/turtles",G={type:u.Hs.GIT_REPO,metadata:{name:"turtles-examples",namespace:"fleet-local"},spec:{branch:"main",correctDrift:{enabled:!1},insecureSkipTLSVerify:!1,paths:[],pollingInterval:"60s",repo:K,targetNamespace:U,targets:[{clusterSelector:{matchExpressions:[{key:"provider.cattle.io",operator:"NotIn",values:["harvester"]}]}}]}},W={aws:"examples/clusterclasses/aws",azure:"examples/clusterclasses/azure",docker:"examples/clusterclasses/docker",vsphere:"examples/clusterclasses/vsphere",applications:"examples/applications"};var Y={emits:["close"],name:"AddExampleRepoDialog",components:{Checkbox:m.A,AsyncButton:h.A,FleetSummary:F},async fetch(){if(this.gitRepo=await this.$store.dispatch("management/create",G),this.$store.getters["management/schemaFor"](u.CU)){let t;try{t=await this.$store.dispatch("management/find",{type:u.CU,id:U})}catch(e){}t||(this.newNamespace=await this.$store.dispatch("management/create",{type:u.CU,metadata:{name:U}}))}},data(){return{gitRepo:{},newNamespace:null,repoOptions:W,allBundles:[]}},computed:{...(0,z.L8)({t:"i18n/t"}),paths:{get(){return this.gitRepo?.spec?.paths||[]},set(e){this.gitRepo.spec.paths=e}}},methods:{async loadBundles(){const e=await f({allBundles:{inStoreType:"management",type:u.Hs.BUNDLE,opt:{excludeFields:["metadata.managedFields","spec.resources"]}}},this.$store);this.allBundles=e.allBundles||[]},async saveGitRepo(e){if(this.newNamespace)try{await this.newNamespace.save()}catch(t){return void this.$store.dispatch("growl/fromError",{title:this.t("capi.exampleClasses.error.creatingNs"),err:t})}try{await this.gitRepo.save(),e(!0),this.loadBundles()}catch(t){this.$store.dispatch("growl/fromError",{title:this.t("capi.exampleClasses.error.creatingGitrepo"),err:t}),e(!1)}},addPath(e){this.paths=[...this.paths,e]},removePath(e){this.paths=this.paths.filter((t=>t!==e))},goToDetail(){this.gitRepo.goToDetail(),this.$emit("close")}}};a(95977);const H=(0,O.A)(Y,[["render",p],["__scopeId","data-v-33874c1f"]]);var J=H},11369:function(e,t,a){var s=a(18889);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("05c26ce9",s,!0,{sourceMap:!1,shadowMode:!1})},69577:function(e,t,a){var s=a(11657);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("969a4540",s,!0,{sourceMap:!1,shadowMode:!1})},58631:function(e,t,a){var s=a(58887);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("0123928c",s,!0,{sourceMap:!1,shadowMode:!1})},95977:function(e,t,a){var s=a(42121);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("a81a79ee",s,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=capi-0.8.3-rc2.umd.min.dialog.js.map